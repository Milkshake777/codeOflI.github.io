<!DOCTYPE html>





<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicon128.ico?v=7.4.1">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicon32.ico?v=7.4.1">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicon16.ico?v=7.4.1">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.1" color="#222">
  <link rel="alternate" href="/atom.xml" title="nicolas" type="application/atom+xml">

<link rel="stylesheet" href="/css/main.css?v=7.4.1">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.4.1',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="[TOC]第二十二章 枚举 关键字 enum 可以将一组具名的值的有限集合创建为一种新的类型，而这些具名的值可以作为常规的程序组件使用。这是一种非常有用的功能 在初始化和清理  这章结束的时候，我们已经简单地介绍了枚举的概念。现在，你对 Java 已经有了更深刻的理解，因此可以更深入地学习 Java 中的枚举了。你将在本章中看到，使用 enum 可以做很多有趣的事情，同时，我们也会深入其他的 Ja">
<meta name="keywords" content="学习笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="OnJava8-4">
<meta property="og:url" content="https://codeofli.github.io/2019/10/java-note/OnJava8/OnJava8-4/index.html">
<meta property="og:site_name" content="nicolas">
<meta property="og:description" content="[TOC]第二十二章 枚举 关键字 enum 可以将一组具名的值的有限集合创建为一种新的类型，而这些具名的值可以作为常规的程序组件使用。这是一种非常有用的功能 在初始化和清理  这章结束的时候，我们已经简单地介绍了枚举的概念。现在，你对 Java 已经有了更深刻的理解，因此可以更深入地学习 Java 中的枚举了。你将在本章中看到，使用 enum 可以做很多有趣的事情，同时，我们也会深入其他的 Ja">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2021-10-23T02:19:02.850Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="OnJava8-4">
<meta name="twitter:description" content="[TOC]第二十二章 枚举 关键字 enum 可以将一组具名的值的有限集合创建为一种新的类型，而这些具名的值可以作为常规的程序组件使用。这是一种非常有用的功能 在初始化和清理  这章结束的时候，我们已经简单地介绍了枚举的概念。现在，你对 Java 已经有了更深刻的理解，因此可以更深入地学习 Java 中的枚举了。你将在本章中看到，使用 enum 可以做很多有趣的事情，同时，我们也会深入其他的 Ja">
  <link rel="canonical" href="https://codeofli.github.io/2019/10/java-note/OnJava8/OnJava8-4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>OnJava8-4 | nicolas</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">nicolas</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">Yesterday you said tomorow.</p>
      
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    
      
      
        
      
        
      
        
      
    

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-about">
      
    
      
      
        
      
        
      
        
      
    

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tags">
      
    
      
      
        
      
        
      
        
          
        
      
    

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">32</span></a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-categories">
      
    
      
      
        
      
        
          
        
      
        
      
    

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类<span class="badge">10</span></a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    
      
      
        
          
        
      
        
      
        
      
    

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">48</span></a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/codeOflI/codeOflI.github.io/tree/dev" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
            

          <div id="content" class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://codeofli.github.io/2019/10/java-note/OnJava8/OnJava8-4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="nicolas lee">
      <meta itemprop="description" content="Yesterday you said tomorow.">
      <meta itemprop="image" content="/assets/img/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nicolas">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">OnJava8-4

          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-10-13 22:19:09" itemprop="dateCreated datePublished" datetime="2019-10-13T22:19:09+08:00">2019-10-13</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-10-23 10:19:02" itemprop="dateModified" datetime="2021-10-23T10:19:02+08:00">2021-10-23</time>
              </span>
            
          

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
          
          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">本文字数：</span>
              
              <span></span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>[TOC]</p><h1 id="第二十二章-枚举"><a href="#第二十二章-枚举" class="headerlink" title="第二十二章 枚举"></a>第二十二章 枚举</h1><blockquote>
<p>关键字 enum 可以将一组具名的值的有限集合创建为一种新的类型，而这些具名的值可以作为常规的程序组件使用。这是一种非常有用的功能</p>
</blockquote><p>在<a href>初始化和清理 </a> 这章结束的时候，我们已经简单地介绍了枚举的概念。现在，你对 Java 已经有了更深刻的理解，因此可以更深入地学习 Java 中的枚举了。你将在本章中看到，使用 enum 可以做很多有趣的事情，同时，我们也会深入其他的 Java 特性，例如泛型和反射。在这个过程中，我们还将学习一些设计模式。</p><a id="more"></a>
<!-- skip because I had read it at thinkInJava4 -->

<!-- Enumerations -->



<!-- Basic enum Features -->

<h2 id="基本-enum-特性"><a href="#基本-enum-特性" class="headerlink" title="基本 enum 特性"></a>基本 enum 特性</h2><p>我们已经在<a href>初始化和清理 </a> 这章章看到，调用 enum 的 values() 方法，可以遍历 enum 实例 .values() 方法返回 enum 实例的数组，而且该数组中的元素严格保持其在 enum 中声明时的顺序，因此你可以在循环中使用 values() 返回的数组。</p>
<p>创建 enum 时，编译器会为你生成一个相关的类，这个类继承自 Java.lang.Enum。下面的例子演示了 Enum 提供的一些功能：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enums/EnumClass.java</span></span><br><span class="line"><span class="comment">// Capabilities of the Enum class</span></span><br><span class="line"><span class="keyword">enum</span> Shrubbery &#123; GROUND, CRAWLING, HANGING &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EnumClass</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(Shrubbery s : Shrubbery.values()) &#123;</span><br><span class="line">            System.out.println(</span><br><span class="line">                    s + <span class="string">" ordinal: "</span> + s.ordinal());</span><br><span class="line">            System.out.print(</span><br><span class="line">                    s.compareTo(Shrubbery.CRAWLING) + <span class="string">" "</span>);</span><br><span class="line">            System.out.print(</span><br><span class="line">                    s.equals(Shrubbery.CRAWLING) + <span class="string">" "</span>);</span><br><span class="line">            System.out.println(s == Shrubbery.CRAWLING);</span><br><span class="line">            System.out.println(s.getDeclaringClass());</span><br><span class="line">            System.out.println(s.name());</span><br><span class="line">            System.out.println(<span class="string">"********************"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">// Produce an enum value from a String name:</span></span><br><span class="line">        <span class="keyword">for</span>(String s :</span><br><span class="line">                <span class="string">"HANGING CRAWLING GROUND"</span>.split(<span class="string">" "</span>)) &#123;</span><br><span class="line">            Shrubbery shrub =</span><br><span class="line">                    Enum.valueOf(Shrubbery.class, s);</span><br><span class="line">            System.out.println(shrub);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">GROUND ordinal: <span class="number">0</span></span><br><span class="line"><span class="number">-1</span> <span class="literal">false</span> <span class="literal">false</span></span><br><span class="line"><span class="keyword">class</span> <span class="symbol">Shrubbery</span></span><br><span class="line"><span class="symbol">GROUND</span></span><br><span class="line">********************</span><br><span class="line"><span class="symbol">CRAWLING</span> <span class="symbol">ordinal: <span class="symbol">1</span></span></span><br><span class="line"><span class="symbol">0</span> <span class="symbol">true</span> <span class="symbol">true</span></span><br><span class="line"><span class="symbol">class</span> <span class="symbol">Shrubbery</span></span><br><span class="line"><span class="symbol">CRAWLING</span></span><br><span class="line">********************</span><br><span class="line"><span class="symbol">HANGING</span> <span class="symbol">ordinal: <span class="symbol">2</span></span></span><br><span class="line"><span class="symbol">1</span> <span class="symbol">false</span> <span class="symbol">false</span></span><br><span class="line"><span class="symbol">class</span> <span class="symbol">Shrubbery</span></span><br><span class="line"><span class="symbol">HANGING</span></span><br><span class="line">********************</span><br><span class="line"><span class="symbol">HANGING</span></span><br><span class="line"><span class="symbol">CRAWLING</span></span><br><span class="line"><span class="symbol">GROUND</span></span><br></pre></td></tr></table></figure>

<p>ordinal() 方法返回一个 int 值，这是每个 enum 实例在声明时的次序，从 0 开始。可以使用==来比较 enum 实例，编译器会自动为你提供 equals() 和 hashCode() 方法。Enum 类实现了 Comparable 接口，所以它具有 compareTo() 方法。同时，它还实现了 Serializable 接口。</p>
<p>如果在 enum 实例上调用 getDeclaringClass() 方法，我们就能知道其所属的 enum 类。</p>
<p>name() 方法返回 enum 实例声明时的名字，这与使用 toString() 方法效果相同。valueOf() 是在 Enum 中定义的 static 方法，它根据给定的名字返回相应的 enum 实例，如果不存在给定名字的实例，将会抛出异常。</p>
<h3 id="将静态类型导入用于-enum"><a href="#将静态类型导入用于-enum" class="headerlink" title="将静态类型导入用于 enum"></a>将静态类型导入用于 enum</h3><p>先看一看 <a href>初始化和清理 </a> 这章中 Burrito.java 的另一个版本：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enums/SpicinessEnum.java</span></span><br><span class="line"><span class="keyword">package</span> enums;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> SpicinessEnum &#123;</span><br><span class="line">    NOT, MILD, MEDIUM, HOT, FLAMING</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// enums/Burrito2.java</span></span><br><span class="line"><span class="comment">// &#123;java enums.Burrito2&#125;</span></span><br><span class="line"><span class="keyword">package</span> enums;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> enums.SpicinessEnum.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Burrito2</span> </span>&#123;</span><br><span class="line">    SpicinessEnum degree;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Burrito2</span><span class="params">(SpicinessEnum degree)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.degree = degree;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Burrito is "</span>+ degree;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="keyword">new</span> Burrito2(NOT));</span><br><span class="line">        System.out.println(<span class="keyword">new</span> Burrito2(MEDIUM));</span><br><span class="line">        System.out.println(<span class="keyword">new</span> Burrito2(HOT));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出为：</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Burrito <span class="keyword">is</span> <span class="keyword">NOT</span></span><br><span class="line">Burrito <span class="keyword">is</span> MEDIUM</span><br><span class="line">Burrito <span class="keyword">is</span> HOT</span><br></pre></td></tr></table></figure>

<p>使用 static import 能够将 enum 实例的标识符带入当前的命名空间，所以无需再用 enum 类型来修饰 enum 实例。这是一个好的想法吗？或者还是显式地修饰 enum 实例更好？这要看代码的复杂程度了。编译器可以确保你使用的是正确的类型，所以唯一需要担心的是，使用静态导入会不会导致你的代码令人难以理解。多数情况下，使用 static import 还是有好处的，不过，程序员还是应该对具体情况进行具体分析。</p>
<p>注意，在定义 enum 的同一个文件中，这种技巧无法使用，如果是在默认包中定义 enum，这种技巧也无法使用（在 Sun 内部对这一点显然也有不同意见）。</p>
<!-- Adding Methods to an enum -->

<h2 id="方法添加"><a href="#方法添加" class="headerlink" title="方法添加"></a>方法添加</h2><p>除了不能继承自一个 enum 之外，我们基本上可以将 enum 看作一个常规的类。也就是说我们可以向 enum 中添加方法。enum 甚至可以有 main() 方法。</p>
<p>一般来说，我们希望每个枚举实例能够返回对自身的描述，而不仅仅只是默认的 toString() 实现，这只能返回枚举实例的名字。为此，你可以提供一个构造器，专门负责处理这个额外的信息，然后添加一个方法，返回这个描述信息。看一看下面的示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enums/OzWitch.java</span></span><br><span class="line"><span class="comment">// The witches in the land of Oz</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> OzWitch &#123;</span><br><span class="line">    <span class="comment">// Instances must be defined first, before methods:</span></span><br><span class="line">    WEST(<span class="string">"Miss Gulch, aka the Wicked Witch of the West"</span>),</span><br><span class="line">    NORTH(<span class="string">"Glinda, the Good Witch of the North"</span>),</span><br><span class="line">    EAST(<span class="string">"Wicked Witch of the East, wearer of the Ruby "</span> +</span><br><span class="line">            <span class="string">"Slippers, crushed by Dorothy's house"</span>),</span><br><span class="line">    SOUTH(<span class="string">"Good by inference, but missing"</span>);</span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    <span class="comment">// Constructor must be package or private access:</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">OzWitch</span><span class="params">(String description)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.description = description;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDescription</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> description; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(OzWitch witch : OzWitch.values())</span><br><span class="line">            System.out.println(</span><br><span class="line">                    witch + <span class="string">": "</span> + witch.getDescription());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出为：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">WEST: Miss Gulch, aka <span class="keyword">the</span> Wicked Witch <span class="keyword">of</span> <span class="keyword">the</span> West</span><br><span class="line">NORTH: Glinda, <span class="keyword">the</span> Good Witch <span class="keyword">of</span> <span class="keyword">the</span> North</span><br><span class="line">EAST: Wicked Witch <span class="keyword">of</span> <span class="keyword">the</span> East, wearer <span class="keyword">of</span> <span class="keyword">the</span> Ruby</span><br><span class="line">Slippers, crushed <span class="keyword">by</span> Dorothy's house</span><br><span class="line">SOUTH: Good <span class="keyword">by</span> inference, <span class="keyword">but</span> missing</span><br></pre></td></tr></table></figure>

<p>注意，如果你打算定义自己的方法，那么必须在 enum 实例序列的最后添加一个分号。同时，Java 要求你必须先定义 enum 实例。如果在定义 enum 实例之前定义了任何方法或属性，那么在编译时就会得到错误信息。</p>
<p>enum 中的构造器与方法和普通的类没有区别，因为除了有少许限制之外，enum 就是一个普通的类。所以，我们可以使用 enum 做许多事情（虽然，我们一般只使用普通的枚举类型）</p>
<p>在这个例子中，虽然我们有意识地将 enum 的构造器声明为 private，但对于它的可访问性而言，其实并没有什么变化，因为（即使不声明为 private）我们只能在 enum 定义的内部使用其构造器创建 enum 实例。一旦 enum 的定义结束，编译器就不允许我们再使用其构造器来创建任何实例了。</p>
<h3 id="覆盖-enum-的方法"><a href="#覆盖-enum-的方法" class="headerlink" title="覆盖 enum 的方法"></a>覆盖 enum 的方法</h3><p>覆盖 toSring() 方法，给我们提供了另一种方式来为枚举实例生成不同的字符串描述信息。<br>在下面的示例中，我们使用的就是实例的名字，不过我们希望改变其格式。覆盖 enum 的 toSring() 方法与覆盖一般类的方法没有区别：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enums/SpaceShip.java</span></span><br><span class="line"><span class="keyword">import</span> java.util.stream.*;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> SpaceShip &#123;</span><br><span class="line">    SCOUT, CARGO, TRANSPORT,</span><br><span class="line">    CRUISER, BATTLESHIP, MOTHERSHIP;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String id = name();</span><br><span class="line">        String lower = id.substring(<span class="number">1</span>).toLowerCase();</span><br><span class="line">        <span class="keyword">return</span> id.charAt(<span class="number">0</span>) + lower;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Stream.of(values())</span><br><span class="line">                .forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出为：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Scout</span></span><br><span class="line"><span class="keyword">Cargo</span></span><br><span class="line"><span class="keyword">Transport</span></span><br><span class="line"><span class="keyword">Cruiser</span></span><br><span class="line"><span class="keyword">Battleship</span></span><br><span class="line"><span class="keyword">Mothership</span></span><br></pre></td></tr></table></figure>

<p>toString() 方法通过调用 name() 方法取得 SpaceShip 的名字，然后将其修改为只有首字母大写的格式。</p>
<!-- enums in switch Statements -->

<h2 id="switch-语句中的-enum"><a href="#switch-语句中的-enum" class="headerlink" title="switch 语句中的 enum"></a>switch 语句中的 enum</h2><p>在 switch 中使用 enum，是 enum 提供的一项非常便利的功能。一般来说，在 switch 中只能使用整数值，而枚举实例天生就具备整数值的次序，并且可以通过 ordinal() 方法取得其次序（显然编译器帮我们做了类似的工作），因此我们可以在 switch 语句中使用 enum。</p>
<p>虽然一般情况下我们必须使用 enum 类型来修饰一个 enum 实例，但是在 case 语句中却不必如此。下面的例子使用 enum 构造了一个小型状态机：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enums/TrafficLight.java</span></span><br><span class="line"><span class="comment">// Enums in switch statements</span></span><br><span class="line"><span class="comment">// Define an enum type:</span></span><br><span class="line"><span class="keyword">enum</span> Signal &#123; GREEN, YELLOW, RED, &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TrafficLight</span> </span>&#123;</span><br><span class="line">    Signal color = Signal.RED;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">change</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span>(color) &#123;</span><br><span class="line">           <span class="comment">// Note you don't have to say Signal.RED</span></span><br><span class="line">            <span class="comment">// in the case statement:</span></span><br><span class="line">            <span class="keyword">case</span> RED: color = Signal.GREEN;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> GREEN: color = Signal.YELLOW;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> YELLOW: color = Signal.RED;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"The traffic light is "</span> + color;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        TrafficLight t = <span class="keyword">new</span> TrafficLight();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">7</span>; i++) &#123;</span><br><span class="line">            System.out.println(t);</span><br><span class="line">            t.change();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出为：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">The traffic light <span class="keyword">is</span> RED</span><br><span class="line">The traffic light <span class="keyword">is</span> GREEN</span><br><span class="line">The traffic light <span class="keyword">is</span> YELLOW</span><br><span class="line">The traffic light <span class="keyword">is</span> RED</span><br><span class="line">The traffic light <span class="keyword">is</span> GREEN</span><br><span class="line">The traffic light <span class="keyword">is</span> YELLOW</span><br><span class="line">The traffic light <span class="keyword">is</span> RED</span><br></pre></td></tr></table></figure>

<p>编译器并没有抱怨 switch 中没有 default 语句，但这并不是因为每一个 Signal 都有对应的 case 语句。如果你注释掉其中的某个 case 语句，编译器同样不会抱怨什么。这意味着，你必须确保自己覆盖了所有的分支。但是，如果在 case 语句中调用 return，那么编译器就会抱怨缺少 default 语句了。这与是否覆盖了 enum 的所有实例无关。</p>
<!-- The Mystery of values() -->

<h2 id="values-方法的神秘之处"><a href="#values-方法的神秘之处" class="headerlink" title="values 方法的神秘之处"></a>values 方法的神秘之处</h2><p>前面已经提到，编译器为你创建的 enum 类都继承自 Enum 类。然而，如果你研究一下 Enum 类就会发现，它并没有 values() 方法。可我们明明已经用过该方法了，难道存在某种“隐藏的”方法吗？我们可以利用反射机制编写一个简单的程序，来查看其中的究竟：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enums/Reflection.java</span></span><br><span class="line"><span class="comment">// Analyzing enums using reflection</span></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"><span class="keyword">enum</span> Explore &#123; HERE, THERE &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Reflection</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span></span><br><span class="line">    <span class="function">Set&lt;String&gt; <span class="title">analyze</span><span class="params">(Class&lt;?&gt; enumClass)</span> </span>&#123;</span><br><span class="line">        System.out.println(</span><br><span class="line">                <span class="string">"_____ Analyzing "</span> + enumClass + <span class="string">" _____"</span>);</span><br><span class="line">        System.out.println(<span class="string">"Interfaces:"</span>);</span><br><span class="line">        <span class="keyword">for</span>(Type t : enumClass.getGenericInterfaces())</span><br><span class="line">            System.out.println(t);</span><br><span class="line">        System.out.println(</span><br><span class="line">                <span class="string">"Base: "</span> + enumClass.getSuperclass());</span><br><span class="line">        System.out.println(<span class="string">"Methods: "</span>);</span><br><span class="line">        Set&lt;String&gt; methods = <span class="keyword">new</span> TreeSet&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(Method m : enumClass.getMethods())</span><br><span class="line">            methods.add(m.getName());</span><br><span class="line">        System.out.println(methods);</span><br><span class="line">        <span class="keyword">return</span> methods;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Set&lt;String&gt; exploreMethods =</span><br><span class="line">                analyze(Explore.class);</span><br><span class="line">        Set&lt;String&gt; enumMethods = analyze(Enum.class);</span><br><span class="line">        System.out.println(</span><br><span class="line">                <span class="string">"Explore.containsAll(Enum)? "</span> +</span><br><span class="line">                        exploreMethods.containsAll(enumMethods));</span><br><span class="line">        System.out.print(<span class="string">"Explore.removeAll(Enum): "</span>);</span><br><span class="line">        exploreMethods.removeAll(enumMethods);</span><br><span class="line">        System.out.println(exploreMethods);</span><br><span class="line"><span class="comment">// Decompile the code for the enum:</span></span><br><span class="line">        OSExecute.command(</span><br><span class="line">                <span class="string">"javap -cp build/classes/main Explore"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">_____ Analyzing <span class="class"><span class="keyword">class</span> <span class="title">Explore</span> <span class="title">_____</span></span></span><br><span class="line">Interfaces:</span><br><span class="line">Base: <span class="class"><span class="keyword">class</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">Enum</span></span></span><br><span class="line">Methods:</span><br><span class="line">[compareTo, equals, getClass, getDeclaringClass,</span><br><span class="line">hashCode, name, notify, notifyAll, ordinal, toString,</span><br><span class="line">valueOf, values, wait]</span><br><span class="line">_____ Analyzing <span class="class"><span class="keyword">class</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">Enum</span> <span class="title">_____</span></span></span><br><span class="line">Interfaces:</span><br><span class="line">java.lang.Comparable&lt;E&gt;</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span></span></span><br><span class="line">Base: class java.lang.Object</span><br><span class="line">Methods:</span><br><span class="line">[compareTo, equals, getClass, getDeclaringClass,</span><br><span class="line">hashCode, name, notify, notifyAll, ordinal, toString,</span><br><span class="line">valueOf, wait]</span><br><span class="line">Explore.containsAll(Enum)? <span class="keyword">true</span></span><br><span class="line">Explore.removeAll(Enum): [values]</span><br><span class="line">Compiled from <span class="string">"Reflection.java"</span></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Explore</span> <span class="keyword">extends</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">Enum</span>&lt;<span class="title">Explore</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Explore HERE;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Explore THERE;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Explore[] values();</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Explore <span class="title">valueOf</span><span class="params">(java.lang.String)</span></span>;</span><br><span class="line">  <span class="keyword">static</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>答案是，values() 是由编译器添加的 static 方法。可以看出，在创建 Explore 的过程中，编译器还为其添加了 valueOf() 方法。这可能有点令人迷惑，Enum 类不是已经有 valueOf() 方法了吗。</p>
<p>不过 Enum 中的 valueOf() 方法需要两个参数，而这个新增的方法只需一个参数。由于这里使用的 Set 只存储方法的名字，而不考虑方法的签名，所以在调用 Explore.removeAll(Enum) 之后，就只剩下[values] 了。</p>
<p>从最后的输出中可以看到，编译器将 Explore 标记为 final 类，所以无法继承自 enum，其中还有一个 static 的初始化子句，稍后我们将学习如何重定义该句。</p>
<p>由于擦除效应（在<a href>泛型 </a> 章节中介绍过），反编译无法得到 Enum 的完整信息，所以它展示的 Explore 的父类只是一个原始的 Enum，而非事实上的 Enum&lt;Explore&gt;。</p>
<p>由于 values() 方法是由编译器插入到 enum 定义中的 static 方法，所以，如果你将 enum 实例向上转型为 Enum，那么 values() 方法就不可访问了。不过，在 Class 中有一个 getEnumConstants0 方法，所以即便 Enum 接口中没有 values0 方法，我们仍然可以通过 Class 对象取得所有 enum 实例。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enums/UpcastEnum.java</span></span><br><span class="line"><span class="comment">// No values() method if you upcast an enum</span></span><br><span class="line"><span class="keyword">enum</span> Search &#123; HITHER, YON &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UpcastEnum</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Search[] vals = Search.values();</span><br><span class="line">        Enum e = Search.HITHER; <span class="comment">// Upcast</span></span><br><span class="line"><span class="comment">// e.values(); // No values() in Enum</span></span><br><span class="line">        <span class="keyword">for</span>(Enum en : e.getClass().getEnumConstants())</span><br><span class="line">            System.out.println(en);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出为：</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">HITHER</span></span><br><span class="line"><span class="attribute">YON</span></span><br></pre></td></tr></table></figure>

<p>因为 getEnumConstants() 是 Class 上的方法，所以你甚至可以对不是枚举的类调用此方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enums/NonEnum.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NonEnum</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Class&lt;Integer&gt; intClass = Integer.class;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span>(Object en : intClass.getEnumConstants())</span><br><span class="line">                System.out.println(en);</span><br><span class="line">        &#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"Expected: "</span> + e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Expected: java.lang.NullPointerException</span><br></pre></td></tr></table></figure>

<p>只不过，此时该方法返回 null，所以当你试图使用其返回的结果时会发生异常。</p>
<!-- Implements, not Inherits -->

<h2 id="实现而非继承"><a href="#实现而非继承" class="headerlink" title="实现而非继承"></a>实现而非继承</h2><p>我们已经知道，所有的 enum 都继承自 Java.lang.Enum 类。由于 Java 不支持多重继承，所以你的 enum 不能再继承其他类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> NotPossible extends Pet &#123; ... <span class="comment">// Won't work</span></span><br></pre></td></tr></table></figure>

<p>然而，在我们创建一个新的 enum 时，可以同时实现一个或多个接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enums/cartoons/EnumImplementation.java</span></span><br><span class="line"><span class="comment">// An enum can implement an interface</span></span><br><span class="line"><span class="comment">// &#123;java enums.cartoons.EnumImplementation&#125;</span></span><br><span class="line"><span class="keyword">package</span> enums.cartoons;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.function.*;</span><br><span class="line"><span class="keyword">enum</span> CartoonCharacter</span><br><span class="line">        implements Supplier&lt;CartoonCharacter&gt; &#123;</span><br><span class="line">    SLAPPY, SPANKY, PUNCHY,</span><br><span class="line">    SILLY, BOUNCY, NUTTY, BOB;</span><br><span class="line">    <span class="keyword">private</span> Random rand =</span><br><span class="line">            <span class="keyword">new</span> Random(<span class="number">47</span>);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CartoonCharacter <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> values()[rand.nextInt(values().length)];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EnumImplementation</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function"><span class="keyword">void</span> <span class="title">printNext</span><span class="params">(Supplier&lt;T&gt; rg)</span> </span>&#123;</span><br><span class="line">        System.out.print(rg.get() + <span class="string">", "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">// Choose any instance:</span></span><br><span class="line">        CartoonCharacter cc = CartoonCharacter.BOB;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">            printNext(cc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出为：</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BOB, </span>PUNCHY, <span class="keyword">BOB, </span>SPANKY, NUTTY, PUNCHY, SLAPPY, NUTTY,</span><br><span class="line"><span class="symbol">NUTTY</span>, SLAPPY,</span><br></pre></td></tr></table></figure>

<p>这个结果有点奇怪，不过你必须要有一个 enum 实例才能调用其上的方法。现在，在任何接受 Supplier 参数的方法中，例如 printNext()，都可以使用 CartoonCharacter。</p>
<!-- Random Selection -->

<h2 id="随机选择"><a href="#随机选择" class="headerlink" title="随机选择"></a>随机选择</h2><p>就像你在 CartoonCharacter.get() 中看到的那样，本章中的很多示例都需要从 enum 实例中进行随机选择。我们可以利用泛型，从而使得这个工作更一般化，并将其加入到我们的工具库中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// onjava/Enums.java</span></span><br><span class="line"><span class="keyword">package</span> onjava;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Enums</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Random rand = <span class="keyword">new</span> Random(<span class="number">47</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Enum&lt;T&gt;&gt; <span class="function">T <span class="title">random</span><span class="params">(Class&lt;T&gt; ec)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> random(ec.getEnumConstants());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">random</span><span class="params">(T[] values)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> values[rand.nextInt(values.length)];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>古怪的语法&lt;T extends Enum&lt;T&gt;&gt; 表示 T 是一个 enum 实例。而将 Class&lt;T&gt; 作为参数的话，我们就可以利用 Class 对象得到 enum 实例的数组了。重载后的 random() 方法只需使用 T[] 作为参数，因为它并不会调用 Enum 上的任何操作，它只需从数组中随机选择一个元素即可。这样，最终的返回类型正是 enum 的类型。</p>
<p>下面是 random() 方法的一个简单示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enums/RandomTest.java</span></span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"><span class="keyword">enum</span> Activity &#123; SITTING, LYING, STANDING, HOPPING,</span><br><span class="line">    RUNNING, DODGING, JUMPING, FALLING, FLYING &#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RandomTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++)</span><br><span class="line">            System.out.print(</span><br><span class="line">                    Enums.random(Activity.class) + <span class="string">" "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出为：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">STANDING</span> <span class="string">FLYING RUNNING STANDING RUNNING STANDING LYING</span></span><br><span class="line"><span class="attr">DODGING</span> <span class="string">SITTING RUNNING HOPPING HOPPING HOPPING RUNNING</span></span><br><span class="line"><span class="attr">STANDING</span> <span class="string">LYING FALLING RUNNING FLYING LYING</span></span><br></pre></td></tr></table></figure>

<!-- Using Interfaces for Organization -->

<h2 id="使用接口组织枚举"><a href="#使用接口组织枚举" class="headerlink" title="使用接口组织枚举"></a>使用接口组织枚举</h2><p>无法从 enum 继承子类有时很令人沮丧。这种需求有时源自我们希望扩展原 enum 中的元素，有时是因为我们希望使用子类将一个 enum 中的元素进行分组。</p>
<p>在一个接口的内部，创建实现该接口的枚举，以此将元素进行分组，可以达到将枚举元素分类组织的目的。举例来说，假设你想用 enum 来表示不同类别的食物，同时还希望每个 enum 元素仍然保持 Food 类型。那可以这样实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enums/menu/Food.java</span></span><br><span class="line"><span class="comment">// Subcategorization of enums within interfaces</span></span><br><span class="line"><span class="keyword">package</span> enums.menu;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Food</span> </span>&#123;</span><br><span class="line">    <span class="keyword">enum</span> Appetizer implements Food &#123;</span><br><span class="line">        SALAD, SOUP, SPRING_ROLLS;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">enum</span> MainCourse implements Food &#123;</span><br><span class="line">        LASAGNE, BURRITO, PAD_THAI,</span><br><span class="line">        LENTILS, HUMMOUS, VINDALOO;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">enum</span> Dessert implements Food &#123;</span><br><span class="line">        TIRAMISU, GELATO, BLACK_FOREST_CAKE,</span><br><span class="line">        FRUIT, CREME_CARAMEL;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">enum</span> Coffee implements Food &#123;</span><br><span class="line">        BLACK_COFFEE, DECAF_COFFEE, ESPRESSO,</span><br><span class="line">        LATTE, CAPPUCCINO, TEA, HERB_TEA;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于 enum 而言，实现接口是使其子类化的唯一办法，所以嵌入在 Food 中的每个 enum 都实现了 Food 接口。现在，在下面的程序中，我们可以说“所有东西都是某种类型的 Food”。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enums/menu/TypeOfFood.java</span></span><br><span class="line"><span class="comment">// &#123;java enums.menu.TypeOfFood&#125;</span></span><br><span class="line"><span class="keyword">package</span> enums.menu;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> enums.menu.Food.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TypeOfFood</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Food food = Appetizer.SALAD;</span><br><span class="line">        food = MainCourse.LASAGNE;</span><br><span class="line">        food = Dessert.GELATO;</span><br><span class="line">        food = Coffee.CAPPUCCINO;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果 enum 类型实现了 Food 接口，那么我们就可以将其实例向上转型为 Food，所以上例中的所有东西都是 Food。</p>
<p>然而，当你需要与一大堆类型打交道时，接口就不如 enum 好用了。例如，如果你想创建一个“校举的枚举”，那么可以创建一个新的 enum，然后用其实例包装 Food 中的每一个 enum 类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enums/menu/Course.java</span></span><br><span class="line"><span class="keyword">package</span> enums.menu;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Course &#123;</span><br><span class="line">    APPETIZER(Food.Appetizer.class),</span><br><span class="line">    MAINCOURSE(Food.MainCourse.class),</span><br><span class="line">    DESSERT(Food.Dessert.class),</span><br><span class="line">    COFFEE(Food.Coffee.class);</span><br><span class="line">    <span class="keyword">private</span> Food[] values;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Course</span><span class="params">(Class&lt;? extends Food&gt; kind)</span> </span>&#123;</span><br><span class="line">        values = kind.getEnumConstants();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Food <span class="title">randomSelection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Enums.random(values);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>每一个 Course 的实例都将其对应的 Class 对象作为构造器的参数。通过 getEnumConstants0 方法，可以从该 Class 对象中取得某个 Food 子类的所有 enum 实例。这些实例在 randomSelection() 中被用到。因此，通过从每一个 Course 实例中随机地选择一个 Food，我们便能够生成一份菜单：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enums/menu/Meal.java</span></span><br><span class="line"><span class="comment">// &#123;java enums.menu.Meal&#125;</span></span><br><span class="line"><span class="keyword">package</span> enums.menu;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Meal</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(Course course : Course.values()) &#123;</span><br><span class="line">                Food food = course.randomSelection();</span><br><span class="line">                System.out.println(food);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">"***"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出为：</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">SPRING_ROLLS</span><br><span class="line">VINDALOO</span><br><span class="line">FRUIT</span><br><span class="line">DECAF_COFFEE</span><br><span class="line"><span class="emphasis">***</span></span><br><span class="line">SOUP</span><br><span class="line">VINDALOO</span><br><span class="line">FRUIT</span><br><span class="line">TEA</span><br><span class="line"><span class="emphasis">***</span></span><br><span class="line">SALAD</span><br><span class="line">BURRITO</span><br><span class="line">FRUIT</span><br><span class="line">TEA</span><br><span class="line"><span class="emphasis">***</span></span><br><span class="line">SALAD</span><br><span class="line">BURRITO</span><br><span class="line">CREME_CARAMEL</span><br><span class="line">LATTE</span><br><span class="line"><span class="emphasis">***</span></span><br><span class="line">SOUP</span><br><span class="line">BURRITO</span><br><span class="line">TIRAMISU</span><br><span class="line">ESPRESSO</span><br><span class="line"><span class="emphasis">***</span></span><br></pre></td></tr></table></figure>

<p>在这个例子中，我们通过遍历每一个 Course 实例来获得“枚举的枚举”的值。稍后，在 VendingMachine.java 中，我们会看到另一种组织枚举实例的方式，但其也有一些其他的限制。</p>
<p>此外，还有一种更简洁的管理枚举的办法，就是将一个 enum 嵌套在另一个 enum 内。就像这样：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enums/SecurityCategory.java</span></span><br><span class="line"><span class="comment">// More succinct subcategorization of enums</span></span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"><span class="keyword">enum</span> SecurityCategory &#123;</span><br><span class="line">    STOCK(Security.Stock.class),</span><br><span class="line">    BOND(Security.Bond.class);</span><br><span class="line">    Security[] values;</span><br><span class="line">    SecurityCategory(Class&lt;? extends Security&gt; kind) &#123;</span><br><span class="line">        values = kind.getEnumConstants();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">Security</span> </span>&#123;</span><br><span class="line">        <span class="keyword">enum</span> Stock implements Security &#123;</span><br><span class="line">            SHORT, LONG, MARGIN</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">enum</span> Bond implements Security &#123;</span><br><span class="line">            MUNICIPAL, JUNK</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Security <span class="title">randomSelection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Enums.random(values);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            SecurityCategory category =</span><br><span class="line">                    Enums.random(SecurityCategory.class);</span><br><span class="line">            System.out.println(category + <span class="string">": "</span> +</span><br><span class="line">                    category.randomSelection());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出为：</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">BOND:</span> MUNICIPAL</span><br><span class="line"><span class="symbol">BOND:</span> MUNICIPAL</span><br><span class="line"><span class="symbol">STOCK:</span> MARGIN</span><br><span class="line"><span class="symbol">STOCK:</span> MARGIN</span><br><span class="line"><span class="symbol">BOND:</span> JUNK</span><br><span class="line"><span class="symbol">STOCK:</span> SHORT</span><br><span class="line"><span class="symbol">STOCK:</span> LONG</span><br><span class="line"><span class="symbol">STOCK:</span> LONG</span><br><span class="line"><span class="symbol">BOND:</span> MUNICIPAL</span><br><span class="line"><span class="symbol">BOND:</span> JUNK</span><br></pre></td></tr></table></figure>

<p>Security 接口的作用是将其所包含的 enum 组合成一个公共类型，这一点是有必要的。然后，SecurityCategory 才能将 Security 中的 enum 作为其构造器的参数使用，以起到组织的效果。</p>
<p>如果我们将这种方式应用于 Food 的例子，结果应该这样：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enums/menu/Meal2.java</span></span><br><span class="line"><span class="comment">// &#123;java enums.menu.Meal2&#125;</span></span><br><span class="line"><span class="keyword">package</span> enums.menu;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Meal2 &#123;</span><br><span class="line">    APPETIZER(Food.Appetizer.class),</span><br><span class="line">    MAINCOURSE(Food.MainCourse.class),</span><br><span class="line">    DESSERT(Food.Dessert.class),</span><br><span class="line">    COFFEE(Food.Coffee.class);</span><br><span class="line">    <span class="keyword">private</span> Food[] values;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Meal2</span><span class="params">(Class&lt;? extends Food&gt; kind)</span> </span>&#123;</span><br><span class="line">        values = kind.getEnumConstants();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Food</span> </span>&#123;</span><br><span class="line">        <span class="keyword">enum</span> Appetizer implements Food &#123;</span><br><span class="line">            SALAD, SOUP, SPRING_ROLLS;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">enum</span> MainCourse implements Food &#123;</span><br><span class="line">            LASAGNE, BURRITO, PAD_THAI,</span><br><span class="line">            LENTILS, HUMMOUS, VINDALOO;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">enum</span> Dessert implements Food &#123;</span><br><span class="line">            TIRAMISU, GELATO, BLACK_FOREST_CAKE,</span><br><span class="line">            FRUIT, CREME_CARAMEL;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">enum</span> Coffee implements Food &#123;</span><br><span class="line">            BLACK_COFFEE, DECAF_COFFEE, ESPRESSO,</span><br><span class="line">            LATTE, CAPPUCCINO, TEA, HERB_TEA;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Food <span class="title">randomSelection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Enums.random(values);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(Meal2 meal : Meal2.values()) &#123;</span><br><span class="line">                Food food = meal.randomSelection();</span><br><span class="line">                System.out.println(food);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">"***"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出为：</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">SPRING_ROLLS</span><br><span class="line">VINDALOO</span><br><span class="line">FRUIT</span><br><span class="line">DECAF_COFFEE</span><br><span class="line"><span class="emphasis">***</span></span><br><span class="line">SOUP</span><br><span class="line">VINDALOO</span><br><span class="line">FRUIT</span><br><span class="line">TEA</span><br><span class="line"><span class="emphasis">***</span></span><br><span class="line">SALAD</span><br><span class="line">BURRITO</span><br><span class="line">FRUIT</span><br><span class="line">TEA</span><br><span class="line"><span class="emphasis">***</span></span><br><span class="line">SALAD</span><br><span class="line">BURRITO</span><br><span class="line">CREME_CARAMEL</span><br><span class="line">LATTE</span><br><span class="line"><span class="emphasis">***</span></span><br><span class="line">SOUP</span><br><span class="line">BURRITO</span><br><span class="line">TIRAMISU</span><br><span class="line">ESPRESSO</span><br><span class="line"><span class="emphasis">***</span></span><br></pre></td></tr></table></figure>

<p>其实，这仅仅是重新组织了一下代码，不过多数情况下，这种方式使你的代码具有更清晰的结构。</p>
<!-- Using EnumSet Instead of Flags -->

<h2 id="使用-EnumSet-替代-Flags"><a href="#使用-EnumSet-替代-Flags" class="headerlink" title="使用 EnumSet 替代 Flags"></a>使用 EnumSet 替代 Flags</h2><p>Set 是一种集合，只能向其中添加不重复的对象。当然，enum 也要求其成员都是唯一的，所以 enumi 看起来也具有集合的行为。不过，由于不能从 enum 中删除或添加元素，所以它只能算是不太有用的集合。Java SE5 引入 EnumSet，是为了通过 enum 创建一种替代品，以替代传统的基于 int 的“位标志”。这种标志可以用来表示某种“开/关”信息，不过，使用这种标志，我们最终操作的只是一些 bit，而不是这些 bit 想要表达的概念，因此很容易写出令人难以理解的代码。</p>
<p>EnumSet 的设计充分考虑到了速度因素，因为它必须与非常高效的 bit 标志相竞争（其操作与 HashSet 相比，非常地快），就其内部而言，它（可能）就是将一个 long 值作为比特向量，所以 EnumSet 非常快速高效。使用 EnumSet 的优点是，它在说明一个二进制位是否存在时，具有更好的表达能力，并且无需担心性能。</p>
<p>EnumSet 中的元素必须来自一个 enum。下面的 enum 表示在一座大楼中，警报传感器的安放位置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enums/AlarmPoints.java</span></span><br><span class="line"><span class="keyword">package</span> enums;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> AlarmPoints &#123;</span><br><span class="line">    STAIR1, STAIR2, LOBBY, OFFICE1, OFFICE2, OFFICE3,</span><br><span class="line">    OFFICE4, BATHROOM, UTILITY, KITCHEN</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后，我们用 EnumSet 来跟踪报警器的状态：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enums/EnumSets.java</span></span><br><span class="line"><span class="comment">// Operations on EnumSets</span></span><br><span class="line"><span class="comment">// &#123;java enums.EnumSets&#125;</span></span><br><span class="line"><span class="keyword">package</span> enums;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> enums.AlarmPoints.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EnumSets</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        EnumSet&lt;AlarmPoints&gt; points =</span><br><span class="line">                EnumSet.noneOf(AlarmPoints.class); <span class="comment">// Empty</span></span><br><span class="line">        points.add(BATHROOM);</span><br><span class="line">        System.out.println(points);</span><br><span class="line">        points.addAll(</span><br><span class="line">                EnumSet.of(STAIR1, STAIR2, KITCHEN));</span><br><span class="line">        System.out.println(points);</span><br><span class="line">        points = EnumSet.allOf(AlarmPoints.class);</span><br><span class="line">        points.removeAll(</span><br><span class="line">                EnumSet.of(STAIR1, STAIR2, KITCHEN));</span><br><span class="line">        System.out.println(points);</span><br><span class="line">        points.removeAll(</span><br><span class="line">                EnumSet.range(OFFICE1, OFFICE4));</span><br><span class="line">        System.out.println(points);</span><br><span class="line">        points = EnumSet.complementOf(points);</span><br><span class="line">        System.out.println(points);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[BATHROOM]</span><br><span class="line">[STAIR1, STAIR2, BATHROOM, KITCHEN]</span><br><span class="line">[LOBBY, OFFICE1, OFFICE2, OFFICE3, OFFICE4, BATHROOM,</span><br><span class="line">UTILITY]</span><br><span class="line">[LOBBY, BATHROOM, UTILITY]</span><br><span class="line">[STAIR1, STAIR2, OFFICE1, OFFICE2, OFFICE3, OFFICE4,</span><br><span class="line">KITCHEN]</span><br></pre></td></tr></table></figure>

<p>使用 static import 可以简化 enum 常量的使用。EnumSet 的方法的名字都相当直观，你可以查阅 JDK 文档找到其完整详细的描述。如果仔细研究了 EnunSet 的文档，你还会发现 of() 方法被重载了很多次，不但为可变数量参数进行了重载，而且为接收 2 至 5 个显式的参数的情况都进行了重载。这也从侧面表现了 EnumSet 对性能的关注。因为，其实只使用单独的 of() 方法解决可变参数已经可以解决整个问题了，但是对比显式的参数，会有一点性能损失。采用现在这种设计，当你只使用 2 到 5 个参数调用 of() 方法时，你可以调用对应的重载过的方法（速度稍快一点），而当你使用一个参数或多过 5 个参数时，你调用的将是使用可变参数的 of() 方法。注意，如果你只使用一个参数，编译器并不会构造可变参数的数组，所以与调用只有一个参数的方法相比，也就不会有额外的性能损耗。</p>
<p>EnumSet 的基础是 long，一个 long 值有 64 位，而一个 enum 实例只需一位 bit 表示其是否存在。<br>也就是说，在不超过一个 long 的表达能力的情况下，你的 EnumSet 可以应用于最多不超过 64 个元素的 enum。如果 enum 超过了 64 个元素会发生什么呢？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enums/BigEnumSet.java</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BigEnumSet</span> </span>&#123;</span><br><span class="line">    <span class="keyword">enum</span> Big &#123; A0, A1, A2, A3, A4, A5, A6, A7, A8, A9,</span><br><span class="line">        A10, A11, A12, A13, A14, A15, A16, A17, A18, A19,</span><br><span class="line">        A20, A21, A22, A23, A24, A25, A26, A27, A28, A29,</span><br><span class="line">        A30, A31, A32, A33, A34, A35, A36, A37, A38, A39,</span><br><span class="line">        A40, A41, A42, A43, A44, A45, A46, A47, A48, A49,</span><br><span class="line">        A50, A51, A52, A53, A54, A55, A56, A57, A58, A59,</span><br><span class="line">        A60, A61, A62, A63, A64, A65, A66, A67, A68, A69,</span><br><span class="line">        A70, A71, A72, A73, A74, A75 &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        EnumSet&lt;Big&gt; bigEnumSet = EnumSet.allOf(Big.class);</span><br><span class="line">        System.out.println(bigEnumSet);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[A0, A1, A2, A3, A4, A5, A6, A7, A8, A9, A10, A11, A12,</span><br><span class="line">A13, A14, A15, A16, A17, A18, A19, A20, A21, A22, A23,</span><br><span class="line">A24, A25, A26, A27, A28, A29, A30, A31, A32, A33, A34,</span><br><span class="line">A35, A36, A37, A38, A39, A40, A41, A42, A43, A44, A45,</span><br><span class="line">A46, A47, A48, A49, A50, A51, A52, A53, A54, A55, A56,</span><br><span class="line">A57, A58, A59, A60, A61, A62, A63, A64, A65, A66, A67,</span><br><span class="line">A68, A69, A70, A71, A72, A73, A74, A75]</span><br></pre></td></tr></table></figure>

<p>显然，EnumSet 可以应用于多过 64 个元素的 enum，所以我猜测，Enum 会在必要的时候增加一个 long。</p>
<!-- Using EnumMap -->

<h2 id="使用-EnumMap"><a href="#使用-EnumMap" class="headerlink" title="使用 EnumMap"></a>使用 EnumMap</h2><p>EnumMap 是一种特殊的 Map，它要求其中的键（key）必须来自一个 enum，由于 enum 本身的限制，所以 EnumMap 在内部可由数组实现。因此 EnumMap 的速度很快，我们可以放心地使用 enum 实例在 EnumMap 中进行查找操作。不过，我们只能将 enum 的实例作为键来调用 put() 可方法，其他操作与使用一般的 Map 差不多。</p>
<p>下面的例子演示了<em>命令设计模式</em>的用法。一般来说，命令模式首先需要一个只有单一方法的接口，然后从该接口实现具有各自不同的行为的多个子类。接下来，程序员就可以构造命令对象，并在需要的时候使用它们了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enums/EnumMaps.java</span></span><br><span class="line"><span class="comment">// Basics of EnumMaps</span></span><br><span class="line"><span class="comment">// &#123;java enums.EnumMaps&#125;</span></span><br><span class="line"><span class="keyword">package</span> enums;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> enums.AlarmPoints.*;</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Command</span> </span>&#123; <span class="function"><span class="keyword">void</span> <span class="title">action</span><span class="params">()</span></span>; &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EnumMaps</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        EnumMap&lt;AlarmPoints,Command&gt; em =</span><br><span class="line">                <span class="keyword">new</span> EnumMap&lt;&gt;(AlarmPoints.class);</span><br><span class="line">        em.put(KITCHEN,</span><br><span class="line">                () -&gt; System.out.println(<span class="string">"Kitchen fire!"</span>));</span><br><span class="line">        em.put(BATHROOM,</span><br><span class="line">                () -&gt; System.out.println(<span class="string">"Bathroom alert!"</span>));</span><br><span class="line">        <span class="keyword">for</span>(Map.Entry&lt;AlarmPoints,Command&gt; e:</span><br><span class="line">                em.entrySet()) &#123;</span><br><span class="line">            System.out.print(e.getKey() + <span class="string">": "</span>);</span><br><span class="line">            e.getValue().action();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123; <span class="comment">// If there's no value for a particular key:</span></span><br><span class="line">            em.get(UTILITY).action();</span><br><span class="line">        &#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"Expected: "</span> + e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出为：</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">BATHROOM:</span> Bathroom alert!</span><br><span class="line"><span class="symbol">KITCHEN:</span> Kitchen fire!</span><br><span class="line"><span class="symbol">Expected:</span> java.lang.NullPointerException</span><br></pre></td></tr></table></figure>

<p>与 EnumSet 一样，enum 实例定义时的次序决定了其在 EnumMap 中的顺序。</p>
<p>main0 方法的最后部分说明，enum 的每个实例作为一个键，总是存在的。但是，如果你没有为这个键调用 put() 方法来存人相应的值的话，其对应的值就是 null。</p>
<p>与常量相关的方法（constant-specific methods 将在下一节中介绍）相比，EnumMap 有一个优点，那 EnumMap 允许程序员改变值对象，而常量相关的方法在编译期就被固定了。稍后你会看到，在你有多种类型的 enum，而且它们之间存在互操作的情况下，我们可以用 EnumMap 实现多路分发（multiple dispatching）。</p>
<!-- Constant-Specific Methods -->

<h2 id="常量特定方法"><a href="#常量特定方法" class="headerlink" title="常量特定方法"></a>常量特定方法</h2><p>Java 的 enum 有一个非常有趣的特性，即它允许程序员为 enum 实例编写方法，从而为每个 enum 实例赋予各自不同的行为。要实现常量相关的方法，你需要为 enum 定义一个或多个 abstract 方法，然后为每个 enum 实例实现该抽象方法。参考下面的例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enums/ConstantSpecificMethod.java</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.text.*;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> ConstantSpecificMethod &#123;</span><br><span class="line">    DATE_TIME &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function">String <span class="title">getInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">                    DateFormat.getDateInstance()</span><br><span class="line">                            .format(<span class="keyword">new</span> Date());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    CLASSPATH &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function">String <span class="title">getInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> System.getenv(<span class="string">"CLASSPATH"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    VERSION &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function">String <span class="title">getInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> System.getProperty(<span class="string">"java.version"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> String <span class="title">getInfo</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(ConstantSpecificMethod csm : values())</span><br><span class="line">            System.out.println(csm.getInfo());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">May <span class="number">9</span>, <span class="number">2017</span></span><br><span class="line">C:\Users\Bruce\Documents\GitHub\on-</span><br><span class="line">java\ExtractedExamples\\gradle\wrapper\gradle-</span><br><span class="line">wrapper.jar</span><br><span class="line"><span class="number">1.8</span>.0_112</span><br></pre></td></tr></table></figure>

<p>通过相应的 enum 实例，我们可以调用其上的方法。这通常也称为表驱动的代码（table-driven code，请注意它与前面提到的命令模式的相似之处）。</p>
<p>在面向对象的程序设计中，不同的行为与不同的类关联。而通过常量相关的方法，每个 enum 实例可以具备自己独特的行为，这似乎说明每个 enum 实例就像一个独特的类。在上面的例子中，enum 实例似乎被当作其“超类”ConstantSpecificMethod 来使用，在调用 getInfo() 方法时，体现出多态的行为。</p>
<p>然而，enum 实例与类的相似之处也仅限于此了。我们并不能真的将 enum 实例作为一个类型来使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enums/NotClasses.java</span></span><br><span class="line"><span class="comment">// &#123;javap -c LikeClasses&#125;</span></span><br><span class="line"><span class="keyword">enum</span> LikeClasses &#123;</span><br><span class="line">    WINKEN &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">behavior</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"Behavior1"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    BLINKEN &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">behavior</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"Behavior2"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    NOD &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">behavior</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"Behavior3"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">behavior</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NotClasses</span> </span>&#123;</span><br><span class="line">    <span class="comment">// void f1(LikeClasses.WINKEN instance) &#123;&#125; // Nope</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出为（前 12 行）：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Compiled from <span class="string">"NotClasses.java"</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">LikeClasses</span> <span class="keyword">extends</span></span></span><br><span class="line"><span class="class"><span class="title">java</span>.<span class="title">lang</span>.<span class="title">Enum</span>&lt;<span class="title">LikeClasses</span>&gt; </span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> LikeClasses WINKEN;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> LikeClasses BLINKEN;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> LikeClasses NOD;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> LikeClasses[] values();</span><br><span class="line">Code:</span><br><span class="line"><span class="number">0</span>: getstatic <span class="comment">#2 // Field</span></span><br><span class="line">$VALUES:[LLikeClasses;</span><br><span class="line"><span class="number">3</span>: invokevirtual <span class="comment">#3 // Method</span></span><br><span class="line"><span class="string">"[LLikeClasses;"</span>.<span class="keyword">clone</span>:()Ljava/lang/Object;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>在方法 f1() 中，编译器不允许我们将一个 enum 实例当作 class 类型。如果我们分析一下编译器生成的代码，就知道这种行为也是很正常的。因为每个 enum 元素都是一个 LikeClasses 类型的 static final 实例。</p>
<p>同时，由于它们是 static 实例，无法访问外部类的非 static 元素或方法，所以对于内部的 enum 的实例而言，其行为与一般的内部类并不相同。</p>
<p>再看一个更有趣的关于洗车的例子。每个顾客在洗车时，都有一个选择菜单，每个选择对应一个不同的动作。可以将一个常量相关的方法关联到一个选择上，再使用一个 EnumSet 来保存客户的选择：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enums/CarWash.java</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CarWash</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> Cycle &#123;</span><br><span class="line">        UNDERBODY &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">void</span> <span class="title">action</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"Spraying the underbody"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        WHEELWASH &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">void</span> <span class="title">action</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"Washing the wheels"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        PREWASH &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">void</span> <span class="title">action</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"Loosening the dirt"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        BASIC &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">void</span> <span class="title">action</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"The basic wash"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        HOTWAX &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">void</span> <span class="title">action</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"Applying hot wax"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        RINSE &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">void</span> <span class="title">action</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"Rinsing"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        BLOWDRY &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">void</span> <span class="title">action</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"Blowing dry"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">action</span><span class="params">()</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">    EnumSet&lt;Cycle&gt; cycles =</span><br><span class="line">            EnumSet.of(Cycle.BASIC, Cycle.RINSE);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Cycle cycle)</span> </span>&#123;</span><br><span class="line">        cycles.add(cycle);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">washCar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(Cycle c : cycles)</span><br><span class="line">            c.action();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cycles.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        CarWash wash = <span class="keyword">new</span> CarWash();</span><br><span class="line">        System.out.println(wash);</span><br><span class="line">        wash.washCar();</span><br><span class="line"><span class="comment">// Order of addition is unimportant:</span></span><br><span class="line">        wash.add(Cycle.BLOWDRY);</span><br><span class="line">        wash.add(Cycle.BLOWDRY); <span class="comment">// Duplicates ignored</span></span><br><span class="line">        wash.add(Cycle.RINSE);</span><br><span class="line">        wash.add(Cycle.HOTWAX);</span><br><span class="line">        System.out.println(wash);</span><br><span class="line">        wash.washCar();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出为：</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">BASIC, </span>RINSE]</span><br><span class="line"><span class="symbol">The</span> <span class="keyword">basic </span>wash</span><br><span class="line"><span class="symbol">Rinsing</span></span><br><span class="line">[<span class="keyword">BASIC, </span>HOTWAX, RINSE, <span class="keyword">BLOWDRY]</span></span><br><span class="line"><span class="keyword">The </span><span class="keyword">basic </span>wash</span><br><span class="line"><span class="symbol">Applying</span> hot wax</span><br><span class="line"><span class="symbol">Rinsing</span></span><br><span class="line"><span class="keyword">Blowing </span>dry</span><br></pre></td></tr></table></figure>

<p>与使用匿名内部类相比较，定义常量相关方法的语法更高效、简洁。</p>
<p>这个例子也展示了 EnumSet 了一些特性。因为它是一个集合，所以对于同一个元素而言，只能出现一次，因此对同一个参数重复地调用 add0 方法会被忽略掉（这是正确的行为，因为一个 bit 位开关只能“打开”一次），同样地，向 EnumSet 添加 enum 实例的顺序并不重要，因为其输出的次序决定于 enum 实例定义时的次序。</p>
<p>除了实现 abstract 方法以外，程序员是否可以覆盖常量相关的方法呢？答案是肯定的，参考下面的程序：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enums/OverrideConstantSpecific.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> OverrideConstantSpecific &#123;</span><br><span class="line">    NUT, BOLT,</span><br><span class="line">    WASHER &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"Overridden method"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"default behavior"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(OverrideConstantSpecific ocs : values()) &#123;</span><br><span class="line">            System.out.print(ocs + <span class="string">": "</span>);</span><br><span class="line">            ocs.f();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出为：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NUT:<span class="built_in"> default </span>behavior</span><br><span class="line">BOLT:<span class="built_in"> default </span>behavior</span><br><span class="line">WASHER: Overridden method</span><br></pre></td></tr></table></figure>

<p>虽然 enum 有某些限制，但是一般而言，我们还是可以将其看作是类。</p>
<h3 id="使用-enum-的职责链"><a href="#使用-enum-的职责链" class="headerlink" title="使用 enum 的职责链"></a>使用 enum 的职责链</h3><p>在职责链（Chain of Responsibility）设计模式中，程序员以多种不同的方式来解决一个问题，然后将它们链接在一起。当一个请求到来时，它遍历这个链，直到链中的某个解决方案能够处理该请求。</p>
<p>通过常量相关的方法，我们可以很容易地实现一个简单的职责链。我们以一个邮局的模型为例。邮局需要以尽可能通用的方式来处理每一封邮件，并且要不断尝试处理邮件，直到该邮件最终被确定为一封死信。其中的每一次尝试可以看作为一个策略（也是一个设计模式），而完整的处理方式列表就是一个职责链。</p>
<p>我们先来描述一下邮件。邮件的每个关键特征都可以用 enum 来表示。程序将随机地生成 Mail 对象，如果要减小一封邮件的 GeneralDelivery 为 YES 的概率，那最简单的方法就是多创建几个不是 YES 的 enum 实例，所以 enum 的定义看起来有点古怪。</p>
<p>我们看到 Mail 中有一个 randomMail() 方法，它负责随机地创建用于测试的邮件。而 generator() 方法生成一个 Iterable 对象，该对象在你调用 next() 方法时，在其内部使用 randomMail() 来创建 Mail 对象。这样的结构使程序员可以通过调用 Mail.generator() 方法，很容易地构造出一个 foreach 循环：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enums/PostOffice.java</span></span><br><span class="line"><span class="comment">// Modeling a post office</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mail</span> </span>&#123;</span><br><span class="line">    <span class="comment">// The NO's reduce probability of random selection:</span></span><br><span class="line">    <span class="keyword">enum</span> GeneralDelivery &#123;YES,NO1,NO2,NO3,NO4,NO5&#125;</span><br><span class="line">    <span class="keyword">enum</span> Scannability &#123;UNSCANNABLE,YES1,YES2,YES3,YES4&#125;</span><br><span class="line">    <span class="keyword">enum</span> Readability &#123;ILLEGIBLE,YES1,YES2,YES3,YES4&#125;</span><br><span class="line">    <span class="keyword">enum</span> Address &#123;INCORRECT,OK1,OK2,OK3,OK4,OK5,OK6&#125;</span><br><span class="line">    <span class="keyword">enum</span> ReturnAddress &#123;MISSING,OK1,OK2,OK3,OK4,OK5&#125;</span><br><span class="line">    GeneralDelivery generalDelivery;</span><br><span class="line">    Scannability scannability;</span><br><span class="line">    Readability readability;</span><br><span class="line">    Address address;</span><br><span class="line">    ReturnAddress returnAddress;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">long</span> counter = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">long</span> id = counter++;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="string">"Mail "</span> + id; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">details</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> toString() +</span><br><span class="line">                <span class="string">", General Delivery: "</span> + generalDelivery +</span><br><span class="line">                <span class="string">", Address Scanability: "</span> + scannability +</span><br><span class="line">                <span class="string">", Address Readability: "</span> + readability +</span><br><span class="line">                <span class="string">", Address Address: "</span> + address +</span><br><span class="line">                <span class="string">", Return address: "</span> + returnAddress;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Generate test Mail:</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Mail <span class="title">randomMail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Mail m = <span class="keyword">new</span> Mail();</span><br><span class="line">        m.generalDelivery =</span><br><span class="line">                Enums.random(GeneralDelivery.class);</span><br><span class="line">        m.scannability =</span><br><span class="line">                Enums.random(Scannability.class);</span><br><span class="line">        m.readability =</span><br><span class="line">                Enums.random(Readability.class);</span><br><span class="line">        m.address = Enums.random(Address.class);</span><br><span class="line">        m.returnAddress =</span><br><span class="line">                Enums.random(ReturnAddress.class);</span><br><span class="line">        <span class="keyword">return</span> m;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span></span><br><span class="line">    <span class="function">Iterable&lt;Mail&gt; <span class="title">generator</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Iterable&lt;Mail&gt;() &#123;</span><br><span class="line">            <span class="keyword">int</span> n = count;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Iterator&lt;Mail&gt; <span class="title">iterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Iterator&lt;Mail&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                        <span class="keyword">return</span> n-- &gt; <span class="number">0</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> Mail <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                        <span class="keyword">return</span> randomMail();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123; <span class="comment">// Not implemented</span></span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PostOffice</span> </span>&#123;</span><br><span class="line">    <span class="keyword">enum</span> MailHandler &#123;</span><br><span class="line">        GENERAL_DELIVERY &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">boolean</span> <span class="title">handle</span><span class="params">(Mail m)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">switch</span>(m.generalDelivery) &#123;</span><br><span class="line">                    <span class="keyword">case</span> YES:</span><br><span class="line">                        System.out.println(</span><br><span class="line">                                <span class="string">"Using general delivery for "</span> + m);</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                    <span class="keyword">default</span>: <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        MACHINE_SCAN &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">boolean</span> <span class="title">handle</span><span class="params">(Mail m)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">switch</span>(m.scannability) &#123;</span><br><span class="line">                    <span class="keyword">case</span> UNSCANNABLE: <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                    <span class="keyword">default</span>:</span><br><span class="line">                        <span class="keyword">switch</span>(m.address) &#123;</span><br><span class="line">                            <span class="keyword">case</span> INCORRECT: <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                            <span class="keyword">default</span>:</span><br><span class="line">                                System.out.println(</span><br><span class="line">                                        <span class="string">"Delivering "</span>+ m + <span class="string">" automatically"</span>);</span><br><span class="line">                                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        VISUAL_INSPECTION &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">boolean</span> <span class="title">handle</span><span class="params">(Mail m)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">switch</span>(m.readability) &#123;</span><br><span class="line">                    <span class="keyword">case</span> ILLEGIBLE: <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                    <span class="keyword">default</span>:</span><br><span class="line">                        <span class="keyword">switch</span>(m.address) &#123;</span><br><span class="line">                            <span class="keyword">case</span> INCORRECT: <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                            <span class="keyword">default</span>:</span><br><span class="line">                                System.out.println(</span><br><span class="line">                                        <span class="string">"Delivering "</span> + m + <span class="string">" normally"</span>);</span><br><span class="line">                                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        RETURN_TO_SENDER &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">boolean</span> <span class="title">handle</span><span class="params">(Mail m)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">switch</span>(m.returnAddress) &#123;</span><br><span class="line">                    <span class="keyword">case</span> MISSING: <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                    <span class="keyword">default</span>:</span><br><span class="line">                        System.out.println(</span><br><span class="line">                                <span class="string">"Returning "</span> + m + <span class="string">" to sender"</span>);</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="function"><span class="keyword">abstract</span> <span class="keyword">boolean</span> <span class="title">handle</span><span class="params">(Mail m)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(Mail m)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(MailHandler handler : MailHandler.values())</span><br><span class="line">            <span class="keyword">if</span>(handler.handle(m))</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">        System.out.println(m + <span class="string">" is a dead letter"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(Mail mail : Mail.generator(<span class="number">10</span>)) &#123;</span><br><span class="line">            System.out.println(mail.details());</span><br><span class="line">            handle(mail);</span><br><span class="line">            System.out.println(<span class="string">"*****"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出为：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">Mail 0, General Delivery: NO2,<span class="built_in"> Address </span>Scanability:</span><br><span class="line">UNSCANNABLE,<span class="built_in"> Address </span>Readability: YES3, Address</span><br><span class="line">Address: OK1, Return address: OK1</span><br><span class="line">Delivering Mail 0 normally</span><br><span class="line">*****</span><br><span class="line">Mail 1, General Delivery: NO5,<span class="built_in"> Address </span>Scanability:</span><br><span class="line">YES3,<span class="built_in"> Address </span>Readability: ILLEGIBLE,<span class="built_in"> Address </span>Address:</span><br><span class="line">OK5, Return address: OK1</span><br><span class="line">Delivering Mail 1 automatically</span><br><span class="line">*****</span><br><span class="line">Mail 2, General Delivery: <span class="literal">YES</span>,<span class="built_in"> Address </span>Scanability:</span><br><span class="line">YES3,<span class="built_in"> Address </span>Readability: YES1,<span class="built_in"> Address </span>Address: OK1,</span><br><span class="line">Return address: OK5</span><br><span class="line">Using general delivery <span class="keyword">for</span> Mail 2</span><br><span class="line">*****</span><br><span class="line">Mail 3, General Delivery: NO4,<span class="built_in"> Address </span>Scanability:</span><br><span class="line">YES3,<span class="built_in"> Address </span>Readability: YES1,<span class="built_in"> Address </span>Address:</span><br><span class="line">INCORRECT, Return address: OK4</span><br><span class="line">Returning Mail 3 <span class="keyword">to</span> sender</span><br><span class="line">*****</span><br><span class="line">Mail 4, General Delivery: NO4,<span class="built_in"> Address </span>Scanability:</span><br><span class="line">UNSCANNABLE,<span class="built_in"> Address </span>Readability: YES1, Address</span><br><span class="line">Address: INCORRECT, Return address: OK2</span><br><span class="line">Returning Mail 4 <span class="keyword">to</span> sender</span><br><span class="line">*****</span><br><span class="line">Mail 5, General Delivery: NO3,<span class="built_in"> Address </span>Scanability:</span><br><span class="line">YES1,<span class="built_in"> Address </span>Readability: ILLEGIBLE,<span class="built_in"> Address </span>Address:</span><br><span class="line">OK4, Return address: OK2</span><br><span class="line">Delivering Mail 5 automatically</span><br><span class="line">*****</span><br><span class="line">Mail 6, General Delivery: <span class="literal">YES</span>,<span class="built_in"> Address </span>Scanability:</span><br><span class="line">YES4,<span class="built_in"> Address </span>Readability: ILLEGIBLE,<span class="built_in"> Address </span>Address:</span><br><span class="line">OK4, Return address: OK4</span><br><span class="line">Using general delivery <span class="keyword">for</span> Mail 6</span><br><span class="line">*****</span><br><span class="line">Mail 7, General Delivery: <span class="literal">YES</span>,<span class="built_in"> Address </span>Scanability:</span><br><span class="line">YES3,<span class="built_in"> Address </span>Readability: YES4,<span class="built_in"> Address </span>Address: OK2,</span><br><span class="line">Return address: MISSING</span><br><span class="line">Using general delivery <span class="keyword">for</span> Mail 7</span><br><span class="line">*****</span><br><span class="line">Mail 8, General Delivery: NO3,<span class="built_in"> Address </span>Scanability:</span><br><span class="line">YES1,<span class="built_in"> Address </span>Readability: YES3,<span class="built_in"> Address </span>Address:</span><br><span class="line">INCORRECT, Return address: MISSING</span><br><span class="line">Mail 8 is a dead letter</span><br><span class="line">*****</span><br><span class="line">Mail 9, General Delivery: NO1,<span class="built_in"> Address </span>Scanability:</span><br><span class="line">UNSCANNABLE,<span class="built_in"> Address </span>Readability: YES2, Address</span><br><span class="line">Address: OK1, Return address: OK4</span><br><span class="line">Delivering Mail 9 normally</span><br><span class="line">*****</span><br></pre></td></tr></table></figure>

<p>职责链由 enum MailHandler 实现，而 enum 定义的次序决定了各个解决策略在应用时的次序。对每一封邮件，都要按此顺序尝试每个解决策略，直到其中一个能够成功地处理该邮件，如果所有的策略都失败了，那么该邮件将被判定为一封死信。</p>
<h3 id="使用-enum-的状态机"><a href="#使用-enum-的状态机" class="headerlink" title="使用 enum 的状态机"></a>使用 enum 的状态机</h3><p>枚举类型非常适合用来创建状态机。一个状态机可以具有有限个特定的状态，它通常根据输入，从一个状态转移到下一个状态，不过也可能存在瞬时状态（transient states），而一旦任务执行结束，状态机就会立刻离开瞬时状态。</p>
<p>每个状态都具有某些可接受的输入，不同的输入会使状态机从当前状态转移到不同的新状态。由于 enum 对其实例有严格限制，非常适合用来表现不同的状态和输入。一般而言，每个状态都具有一些相关的输出。</p>
<p>自动售贷机是一个很好的状态机的例子。首先，我们用一个 enum 定义各种输入：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enums/Input.java</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Input &#123;</span><br><span class="line">    NICKEL(<span class="number">5</span>), DIME(<span class="number">10</span>), QUARTER(<span class="number">25</span>), DOLLAR(<span class="number">100</span>),</span><br><span class="line">    TOOTHPASTE(<span class="number">200</span>), CHIPS(<span class="number">75</span>), SODA(<span class="number">100</span>), SOAP(<span class="number">50</span>),</span><br><span class="line">    ABORT_TRANSACTION &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">amount</span><span class="params">()</span> </span>&#123; <span class="comment">// Disallow</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"ABORT.amount()"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    STOP &#123; <span class="comment">// This must be the last instance.</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">amount</span><span class="params">()</span> </span>&#123; <span class="comment">// Disallow</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"SHUT_DOWN.amount()"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">int</span> value; <span class="comment">// In cents</span></span><br><span class="line">    Input(<span class="keyword">int</span> value) &#123; <span class="keyword">this</span>.value = value; &#125;</span><br><span class="line">    Input() &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">amount</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> value; &#125;; <span class="comment">// In cents</span></span><br><span class="line">    <span class="keyword">static</span> Random rand = <span class="keyword">new</span> Random(<span class="number">47</span>);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Input <span class="title">randomSelection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Don't include STOP:</span></span><br><span class="line">        <span class="keyword">return</span> values()[rand.nextInt(values().length - <span class="number">1</span>)];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意，除了两个特殊的 Input 实例之外，其他的 Input 都有相应的价格，因此在接口中定义了 amount（方法。然而，对那两个特殊 Input 实例而言，调用 amount（方法并不合适，所以如果程序员调用它们的 amount）方法就会有异常抛出（在接口内定义了一个方法，然后在你调用该方法的某个实现时就会抛出异常），这似乎有点奇怪，但由于 enum 的限制，我们不得不采用这种方式。</p>
<p>VendingMachine 对输入的第一个反应是将其归类为 Category enum 中的某一个 enum 实例，这可以通过 switch 实现。下面的例子演示了 enum 是如何使代码变得更加清晰且易于管理的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enums/VendingMachine.java</span></span><br><span class="line"><span class="comment">// &#123;java VendingMachine VendingMachineInput.txt&#125;</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.function.*;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.*;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.*;</span><br><span class="line"><span class="keyword">enum</span> Category &#123;</span><br><span class="line">    MONEY(Input.NICKEL, Input.DIME,</span><br><span class="line">            Input.QUARTER, Input.DOLLAR),</span><br><span class="line">    ITEM_SELECTION(Input.TOOTHPASTE, Input.CHIPS,</span><br><span class="line">            Input.SODA, Input.SOAP),</span><br><span class="line">    QUIT_TRANSACTION(Input.ABORT_TRANSACTION),</span><br><span class="line">    SHUT_DOWN(Input.STOP);</span><br><span class="line">    <span class="keyword">private</span> Input[] values;</span><br><span class="line">    Category(Input... types) &#123; values = types; &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> EnumMap&lt;Input,Category&gt; categories =</span><br><span class="line">            <span class="keyword">new</span> EnumMap&lt;&gt;(Input.class);</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(Category c : Category.class.getEnumConstants())</span><br><span class="line">            <span class="keyword">for</span>(Input type : c.values)</span><br><span class="line">                categories.put(type, c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Category <span class="title">categorize</span><span class="params">(Input input)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> categories.get(input);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VendingMachine</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> State state = State.RESTING;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> amount = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Input selection = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">enum</span> StateDuration &#123; TRANSIENT &#125; <span class="comment">// Tagging enum</span></span><br><span class="line">    <span class="keyword">enum</span> State &#123;</span><br><span class="line">        RESTING &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">void</span> <span class="title">next</span><span class="params">(Input input)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">switch</span>(Category.categorize(input)) &#123;</span><br><span class="line">                    <span class="keyword">case</span> MONEY:</span><br><span class="line">                        amount += input.amount();</span><br><span class="line">                        state = ADDING_MONEY;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> SHUT_DOWN:</span><br><span class="line">                        state = TERMINAL;</span><br><span class="line">                    <span class="keyword">default</span>:</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        ADDING_MONEY &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">void</span> <span class="title">next</span><span class="params">(Input input)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">switch</span>(Category.categorize(input)) &#123;</span><br><span class="line">                    <span class="keyword">case</span> MONEY:</span><br><span class="line">                        amount += input.amount();</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> ITEM_SELECTION:</span><br><span class="line">                        selection = input;</span><br><span class="line">                        <span class="keyword">if</span>(amount &lt; selection.amount())</span><br><span class="line">                            System.out.println(</span><br><span class="line">                                    <span class="string">"Insufficient money for "</span> + selection);</span><br><span class="line">                        <span class="keyword">else</span> state = DISPENSING;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> QUIT_TRANSACTION:</span><br><span class="line">                        state = GIVING_CHANGE;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> SHUT_DOWN:</span><br><span class="line">                        state = TERMINAL;</span><br><span class="line">                    <span class="keyword">default</span>:</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        DISPENSING(StateDuration.TRANSIENT) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">void</span> <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"here is your "</span> + selection);</span><br><span class="line">                amount -= selection.amount();</span><br><span class="line">                state = GIVING_CHANGE;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        GIVING_CHANGE(StateDuration.TRANSIENT) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">void</span> <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(amount &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    System.out.println(<span class="string">"Your change: "</span> + amount);</span><br><span class="line">                    amount = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                state = RESTING;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        TERMINAL &#123;<span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">output</span><span class="params">()</span> </span>&#123; System.out.println(<span class="string">"Halted"</span>); &#125; &#125;;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> isTransient = <span class="keyword">false</span>;</span><br><span class="line">        State() &#123;&#125;</span><br><span class="line">        State(StateDuration trans) &#123; isTransient = <span class="keyword">true</span>; &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">next</span><span class="params">(Input input)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Only call "</span> +</span><br><span class="line">                    <span class="string">"next(Input input) for non-transient states"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(</span><br><span class="line">                    <span class="string">"Only call next() for "</span> +</span><br><span class="line">                            <span class="string">"StateDuration.TRANSIENT states"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">output</span><span class="params">()</span> </span>&#123; System.out.println(amount); &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(Supplier&lt;Input&gt; gen)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(state != State.TERMINAL) &#123;</span><br><span class="line">            state.next(gen.get());</span><br><span class="line">            <span class="keyword">while</span>(state.isTransient)</span><br><span class="line">                state.next();</span><br><span class="line">            state.output();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Supplier&lt;Input&gt; gen = <span class="keyword">new</span> RandomInputSupplier();</span><br><span class="line">        <span class="keyword">if</span>(args.length == <span class="number">1</span>)</span><br><span class="line">            gen = <span class="keyword">new</span> FileInputSupplier(args[<span class="number">0</span>]);</span><br><span class="line">        run(gen);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// For a basic sanity check:</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RandomInputSupplier</span> <span class="keyword">implements</span> <span class="title">Supplier</span>&lt;<span class="title">Input</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Input <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Input.randomSelection();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create Inputs from a file of ';'-separated strings:</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileInputSupplier</span> <span class="keyword">implements</span> <span class="title">Supplier</span>&lt;<span class="title">Input</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Iterator&lt;String&gt; input;</span><br><span class="line">    FileInputSupplier(String fileName) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            input = Files.lines(Paths.get(fileName))</span><br><span class="line">                    .skip(<span class="number">1</span>) <span class="comment">// Skip the comment line</span></span><br><span class="line">                    .flatMap(s -&gt; Arrays.stream(s.split(<span class="string">";"</span>)))</span><br><span class="line">                    .map(String::trim)</span><br><span class="line">                    .collect(Collectors.toList())</span><br><span class="line">                    .iterator();</span><br><span class="line">        &#125; <span class="keyword">catch</span>(IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Input <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!input.hasNext())</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">return</span> Enum.valueOf(Input.class, input.next().trim());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出为：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">25</span></span><br><span class="line"><span class="number">50</span></span><br><span class="line"><span class="number">75</span></span><br><span class="line">here <span class="keyword">is</span> your CHIPS</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">100</span></span><br><span class="line"><span class="number">200</span></span><br><span class="line">here <span class="keyword">is</span> your TOOTHPASTE</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">25</span></span><br><span class="line"><span class="number">35</span></span><br><span class="line">Your change: <span class="number">35</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">25</span></span><br><span class="line"><span class="number">35</span></span><br><span class="line">Insufficient money <span class="keyword">for</span> SODA</span><br><span class="line"><span class="number">35</span></span><br><span class="line"><span class="number">60</span></span><br><span class="line"><span class="number">70</span></span><br><span class="line"><span class="number">75</span></span><br><span class="line">Insufficient money <span class="keyword">for</span> SODA</span><br><span class="line"><span class="number">75</span></span><br><span class="line">Your change: <span class="number">75</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line">Halted</span><br></pre></td></tr></table></figure>

<p>由于用 switch 语句从 enum 实例中进行选择是最常见的一种方式（请注意，为了使 enum 在 switch 语句中的使用变得简单，我们是需要付出其他代价的），所以，我们经常遇到这样的问题：将多个 enum 进行分类时，“我们希望在什么 enum 中使用 switch 语句？”我们通过 VendingMachine 的例子来研究一下这个问题。对于每一个 State，我们都需要在输入动作的基本分类中进行查找：用户塞入钞票，选择了某个货物，操作被取消，以及机器停止。然而，在这些基本分类之下，我们又可以塞人不同类型的钞票，可以选择不同的货物。Category enum 将不同类型的 Input 进行分组，因而，可以使用 categorize0 方法为 switch 语句生成恰当的 Cateroy 实例。并且，该方法使用的 EnumMap 确保了在其中进行查询时的效率与安全。</p>
<p>如果读者仔细研究 VendingMachine 类，就会发现每种状态的不同之处，以及对于输入的不同响应，其中还有两个瞬时状态。在 run() 方法中，状态机等待着下一个 Input，并一直在各个状态中移动，直到它不再处于瞬时状态。</p>
<p>通过两种不同的 Generator 对象，我们可以使用不同的 Supplier 对象来测试 VendingMachine，首先是 RandomInputSupplier，它会不停地生成除了 SHUT-DOWN 之外的各种输入。通过长时间地运行 RandomInputSupplier，可以起到健全测试（sanity test）的作用，能够确保该状态机不会进入一个错误状态。另一个是 FileInputSupplier，使用文件以文本的方式来描述输入，然后将它们转换成 enum 实例，并创建对应的 Input 对象。上面的程序使用的正是如下的文本文件：</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// enums/VendingMachineInput.txt</span><br><span class="line">QUARTER<span class="comment">; QUARTER; QUARTER; CHIPS;</span></span><br><span class="line">DOLLAR<span class="comment">; DOLLAR; TOOTHPASTE;</span></span><br><span class="line">QUARTER<span class="comment">; DIME; ABORT_TRANSACTION;</span></span><br><span class="line">QUARTER<span class="comment">; DIME; SODA;</span></span><br><span class="line">QUARTER<span class="comment">; DIME; NICKEL; SODA;</span></span><br><span class="line">ABORT_TRANSACTION<span class="comment">;</span></span><br><span class="line">STOP<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>FileInputSupplier 构造函数将此文件转换为流，并跳过注释行。然后它使用 String.split() 以分号进行分割。这会生成一个 String 数组，并可以通过将其转换为 Stream，然后应用 flatMap() 来将其输入到流中。其输出结果将去除所有空格空格，并转换为 List&lt;String&gt;，且从中获取 Iterator&lt;String&gt;。</p>
<p>这种设计有一个缺陷，它要求 enum State 实例访问的 VendingMachine 属性必须声明为 static，这意味着，你只能有一个 VendingMachine 实例。不过如果我们思考一下实际的（嵌入式 Java）应用，这也许并不是一个大问题，因为在一台机器上，我们可能只有一个应用程序。</p>
<!-- Multiple Dispatching -->

<h2 id="多路分发"><a href="#多路分发" class="headerlink" title="多路分发"></a>多路分发</h2><p>当你要处理多种交互类型时，程序可能会变得相当杂乱。举例来说，如果一个系统要分析和执行数学表达式。我们可能会声明 Number.plus(Number)，Number.multiple(Number) 等等，其中 Number 是各种数字对象的超类。然而，当你声明 a.plus(b) 时，你并不知道 a 或 b 的确切类型，那你如何能让它们正确地交互呢？</p>
<p>你可能从未思考过这个问题的答案.Java 只支持单路分发。也就是说，如果要执行的操作包含了不止一个类型未知的对象时，那么 Java 的动态绑定机制只能处理其中一个的类型。这就无法解决我们上面提到的问题。所以，你必须自己来判定其他的类型，从而实现自己的动态线定行为。</p>
<p>解决上面问题的办法就是多路分发（在那个例子中，只有两个分发，一般称之为两路分发）.多态只能发生在方法调用时，所以，如果你想使用两路分发，那么就必须有两个方法调用：第一个方法调用决定第一个未知类型，第二个方法调用决定第二个未知的类型。要利用多路分发，程序员必须为每一个类型提供一个实际的方法调用，如果你要处理两个不同的类型体系，就需要为每个类型体系执行一个方法调用。一般而言，程序员需要有设定好的某种配置，以便一个方法调用能够引出更多的方法调用，从而能够在这个过程中处理多种类型。为了达到这种效果，我们需要与多个方法一同工作：因为每个分发都需要一个方法调用。在下面的例子中（实现了 “石头、剪刀、布”游戏，也称为 RoShamBo）对应的方法是 compete() 和 eval()，二者都是同一个类型的成员，它们可以产生三种 Outcome 实例中的一个作为结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enums/Outcome.java</span></span><br><span class="line"><span class="keyword">package</span> enums;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Outcome &#123; WIN, LOSE, DRAW &#125;</span><br><span class="line"><span class="comment">// enums/RoShamBo1.java</span></span><br><span class="line"><span class="comment">// Demonstration of multiple dispatching</span></span><br><span class="line"><span class="comment">// &#123;java enums.RoShamBo1&#125;</span></span><br><span class="line"><span class="keyword">package</span> enums;</span><br><span class="line">        <span class="keyword">import</span> java.util.*;</span><br><span class="line">        <span class="keyword">import</span> <span class="keyword">static</span> enums.Outcome.*;</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line">    <span class="function">Outcome <span class="title">compete</span><span class="params">(Item it)</span></span>;</span><br><span class="line">    <span class="function">Outcome <span class="title">eval</span><span class="params">(Paper p)</span></span>;</span><br><span class="line">    <span class="function">Outcome <span class="title">eval</span><span class="params">(Scissors s)</span></span>;</span><br><span class="line">    <span class="function">Outcome <span class="title">eval</span><span class="params">(Rock r)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Paper</span> <span class="keyword">implements</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Outcome <span class="title">compete</span><span class="params">(Item it)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> it.eval(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Outcome <span class="title">eval</span><span class="params">(Paper p)</span> </span>&#123; <span class="keyword">return</span> DRAW; &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Outcome <span class="title">eval</span><span class="params">(Scissors s)</span> </span>&#123; <span class="keyword">return</span> WIN; &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Outcome <span class="title">eval</span><span class="params">(Rock r)</span> </span>&#123; <span class="keyword">return</span> LOSE; &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="string">"Paper"</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Scissors</span> <span class="keyword">implements</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Outcome <span class="title">compete</span><span class="params">(Item it)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> it.eval(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Outcome <span class="title">eval</span><span class="params">(Paper p)</span> </span>&#123; <span class="keyword">return</span> LOSE; &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Outcome <span class="title">eval</span><span class="params">(Scissors s)</span> </span>&#123; <span class="keyword">return</span> DRAW; &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Outcome <span class="title">eval</span><span class="params">(Rock r)</span> </span>&#123; <span class="keyword">return</span> WIN; &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="string">"Scissors"</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rock</span> <span class="keyword">implements</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Outcome <span class="title">compete</span><span class="params">(Item it)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> it.eval(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Outcome <span class="title">eval</span><span class="params">(Paper p)</span> </span>&#123; <span class="keyword">return</span> WIN; &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Outcome <span class="title">eval</span><span class="params">(Scissors s)</span> </span>&#123; <span class="keyword">return</span> LOSE; &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Outcome <span class="title">eval</span><span class="params">(Rock r)</span> </span>&#123; <span class="keyword">return</span> DRAW; &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="string">"Rock"</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RoShamBo1</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SIZE = <span class="number">20</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Random rand = <span class="keyword">new</span> Random(<span class="number">47</span>);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Item <span class="title">newItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span>(rand.nextInt(<span class="number">3</span>)) &#123;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>: <span class="keyword">return</span> <span class="keyword">new</span> Scissors();</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>: <span class="keyword">return</span> <span class="keyword">new</span> Paper();</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>: <span class="keyword">return</span> <span class="keyword">new</span> Rock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">match</span><span class="params">(Item a, Item b)</span> </span>&#123;</span><br><span class="line">        System.out.println(</span><br><span class="line">                a + <span class="string">" vs. "</span> + b + <span class="string">": "</span> + a.compete(b));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; SIZE; i++)</span><br><span class="line">            match(newItem(), newItem());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出为：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Rock <span class="keyword">vs</span>. Rock: DRAW</span><br><span class="line">Paper <span class="keyword">vs</span>. Rock: WIN</span><br><span class="line">Paper <span class="keyword">vs</span>. Rock: WIN</span><br><span class="line">Paper <span class="keyword">vs</span>. Rock: WIN</span><br><span class="line">Scissors <span class="keyword">vs</span>. Paper: WIN</span><br><span class="line">Scissors <span class="keyword">vs</span>. Scissor<span class="variable">s:</span> DRAW</span><br><span class="line">Scissors <span class="keyword">vs</span>. Paper: WIN</span><br><span class="line">Rock <span class="keyword">vs</span>. Paper: LOSE</span><br><span class="line">Paper <span class="keyword">vs</span>. Paper: DRAW</span><br><span class="line">Rock <span class="keyword">vs</span>. Paper: LOSE</span><br><span class="line">Paper <span class="keyword">vs</span>. Scissor<span class="variable">s:</span> LOSE</span><br><span class="line">Paper <span class="keyword">vs</span>. Scissor<span class="variable">s:</span> LOSE</span><br><span class="line">Rock <span class="keyword">vs</span>. Scissor<span class="variable">s:</span> WIN</span><br><span class="line">Rock <span class="keyword">vs</span>. Paper: LOSE</span><br><span class="line">Paper <span class="keyword">vs</span>. Rock: WIN</span><br><span class="line">Scissors <span class="keyword">vs</span>. Paper: WIN</span><br><span class="line">Paper <span class="keyword">vs</span>. Scissor<span class="variable">s:</span> LOSE</span><br><span class="line">Paper <span class="keyword">vs</span>. Scissor<span class="variable">s:</span> LOSE</span><br><span class="line">Paper <span class="keyword">vs</span>. Scissor<span class="variable">s:</span> LOSE</span><br><span class="line">Paper <span class="keyword">vs</span>. Scissor<span class="variable">s:</span> LOSE</span><br></pre></td></tr></table></figure>

<p>Item 是这几种类型的接口，将会被用作多路分发。RoShamBo1.match() 有两个 Item 参数，通过调用 Item.compete90) 方法开始两路分发。要判定 a 的类型，分发机制会在 a 的实际类型的 compete（内部起到分发的作用。compete() 方法通过调用 eval() 来为另一个类型实现第二次分法。</p>
<p>将自身（this）作为参数调用 evalo，能够调用重载过的 eval() 方法，这能够保留第一次分发的类型信息。当第二次分发完成时，你就能够知道两个 Item 对象的具体类型了。</p>
<p>要配置好多路分发需要很多的工序，不过要记住，它的好处在于方法调用时的优雅的话法，这避免了在一个方法中判定多个对象的类型的丑陋代码，你只需说，“嘿，你们两个，我不在乎你们是什么类型，请你们自己交流！”不过，在使用多路分发前，请先明确，这种优雅的代码对你确实有重要的意义。</p>
<h3 id="使用-enum-分发"><a href="#使用-enum-分发" class="headerlink" title="使用 enum 分发"></a>使用 enum 分发</h3><p>直接将 RoShamBol.java 翻译为基于 enum 的版本是有问题的，因为 enum 实例不是类型，不能将 enum 实例作为参数的类型，所以无法重载 eval() 方法。不过，还有很多方式可以实现多路分发，并从 enum 中获益。</p>
<p>一种方式是使用构造器来初始化每个 enum 实例，并以“一组”结果作为参数。这二者放在一块，形成了类似查询表的结构：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enums/RoShamBo2.java</span></span><br><span class="line"><span class="comment">// Switching one enum on another</span></span><br><span class="line"><span class="comment">// &#123;java enums.RoShamBo2&#125;</span></span><br><span class="line"><span class="keyword">package</span> enums;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> enums.Outcome.*;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> RoShamBo2 implements Competitor&lt;RoShamBo2&gt; &#123;</span><br><span class="line">    PAPER(DRAW, LOSE, WIN),</span><br><span class="line">    SCISSORS(WIN, DRAW, LOSE),</span><br><span class="line">    ROCK(LOSE, WIN, DRAW);</span><br><span class="line">    <span class="keyword">private</span> Outcome vPAPER, vSCISSORS, vROCK;</span><br><span class="line">    RoShamBo2(Outcome paper,</span><br><span class="line">              Outcome scissors, Outcome rock) &#123;</span><br><span class="line">        <span class="keyword">this</span>.vPAPER = paper;</span><br><span class="line">        <span class="keyword">this</span>.vSCISSORS = scissors;</span><br><span class="line">        <span class="keyword">this</span>.vROCK = rock;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Outcome <span class="title">compete</span><span class="params">(RoShamBo2 it)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span>(it) &#123;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">case</span> PAPER: <span class="keyword">return</span> vPAPER;</span><br><span class="line">            <span class="keyword">case</span> SCISSORS: <span class="keyword">return</span> vSCISSORS;</span><br><span class="line">            <span class="keyword">case</span> ROCK: <span class="keyword">return</span> vROCK;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        RoShamBo.play(RoShamBo2.class, <span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出为：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ROCK vs. <span class="string">ROCK:</span> DRAW</span><br><span class="line">SCISSORS vs. <span class="string">ROCK:</span> LOSE</span><br><span class="line">SCISSORS vs. <span class="string">ROCK:</span> LOSE</span><br><span class="line">SCISSORS vs. <span class="string">ROCK:</span> LOSE</span><br><span class="line">PAPER vs. <span class="string">SCISSORS:</span> LOSE</span><br><span class="line">PAPER vs. <span class="string">PAPER:</span> DRAW</span><br><span class="line">PAPER vs. <span class="string">SCISSORS:</span> LOSE</span><br><span class="line">ROCK vs. <span class="string">SCISSORS:</span> WIN</span><br><span class="line">SCISSORS vs. <span class="string">SCISSORS:</span> DRAW</span><br><span class="line">ROCK vs. <span class="string">SCISSORS:</span> WIN</span><br><span class="line">SCISSORS vs. <span class="string">PAPER:</span> WIN</span><br><span class="line">SCISSORS vs. <span class="string">PAPER:</span> WIN</span><br><span class="line">ROCK vs. <span class="string">PAPER:</span> LOSE</span><br><span class="line">ROCK vs. <span class="string">SCISSORS:</span> WIN</span><br><span class="line">SCISSORS vs. <span class="string">ROCK:</span> LOSE</span><br><span class="line">PAPER vs. <span class="string">SCISSORS:</span> LOSE</span><br><span class="line">SCISSORS vs. <span class="string">PAPER:</span> WIN</span><br><span class="line">SCISSORS vs. <span class="string">PAPER:</span> WIN</span><br><span class="line">SCISSORS vs. <span class="string">PAPER:</span> WIN</span><br><span class="line">SCISSORS vs. <span class="string">PAPER:</span> WIN</span><br></pre></td></tr></table></figure>

<p>在 compete() 方法中，一旦两种类型都被确定了，那么唯一的操作就是返回结果 Outcome 然而，你可能还需要调用其他的方法，（例如）甚至是调用在构造器中指定的某个命令对象上的方法。</p>
<p>RoShamBo2.javal 之前的例子短小得多，而且更直接，更易于理解。注意，我们仍然是使用两路分发来判定两个对象的类型。在 RoShamBol.java 中，两次分发都是通过实际的方法调用实现，而在这个例子中，只有第一次分发是实际的方法调用。第二个分发使用的是 switch，不过这样做是安全的，因为 enum 限制了 switch 语句的选择分支。</p>
<p>在代码中，enum 被单独抽取出来，因此它可以应用在其他例子中。首先，Competitor 接口定义了一种类型，该类型的对象可以与另一个 Competitor 相竞争：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enums/Competitor.java</span></span><br><span class="line"><span class="comment">// Switching one enum on another</span></span><br><span class="line"><span class="keyword">package</span> enums;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Competitor</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Competitor</span>&lt;<span class="title">T</span>&gt;&gt; </span>&#123;</span><br><span class="line">    <span class="function">Outcome <span class="title">compete</span><span class="params">(T competitor)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后，我们定义两个 static 方法（static 可以避免显式地指明参数类型），第一个是 match() 方法，它会为一个 Competitor 对象调用 compete() 方法，并与另一个 Competitor 对象作比较。在这个例子中，我们看到，match()）方法的参数需要是 Competitor&lt;T&gt; 类型。但是在 play() 方法中，类型参数必须同时是 Enum&lt;T&gt; 类型（因为它将在 Enums.random() 中使用）和 Competitor&lt;T&gt; 类型因为它将被传递给 match() 方法）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enums/RoShamBo.java</span></span><br><span class="line"><span class="comment">// Common tools for RoShamBo examples</span></span><br><span class="line"><span class="keyword">package</span> enums;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RoShamBo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Competitor&lt;T&gt;&gt;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">match</span><span class="params">(T a, T b)</span> </span>&#123;</span><br><span class="line">        System.out.println(</span><br><span class="line">                a + <span class="string">" vs. "</span> + b + <span class="string">": "</span> + a.compete(b));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Enum&lt;T&gt; &amp; Competitor&lt;T&gt;&gt;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">play</span><span class="params">(Class&lt;T&gt; rsbClass, <span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">            match(Enums.random(rsbClass),Enums.random(rsbClass));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>play() 方法没有将类型参数 T 作为返回值类型，因此，似乎我们应该在 Class&lt;T&gt; 中使用通配符来代替上面的参数声明。然而，通配符不能扩展多个基类，所以我们必须采用以上的表达式。</p>
<h3 id="使用常量相关的方法"><a href="#使用常量相关的方法" class="headerlink" title="使用常量相关的方法"></a>使用常量相关的方法</h3><p>常量相关的方法允许我们为每个 enum 实例提供方法的不同实现，这使得常量相关的方法似乎是实现多路分发的完美解决方案。不过，通过这种方式，enum 实例虽然可以具有不同的行为，但它们仍然不是类型，不能将其作为方法签名中的参数类型来使用。最好的办法是将 enum 用在 switch 语句中，见下例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enums/RoShamBo3.java</span></span><br><span class="line"><span class="comment">// Using constant-specific methods</span></span><br><span class="line"><span class="comment">// &#123;java enums.RoShamBo3&#125;</span></span><br><span class="line"><span class="keyword">package</span> enums;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> enums.Outcome.*;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> RoShamBo3 implements Competitor&lt;RoShamBo3&gt; &#123;</span><br><span class="line">    PAPER &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Outcome <span class="title">compete</span><span class="params">(RoShamBo3 it)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">switch</span>(it) &#123;</span><br><span class="line">                <span class="keyword">default</span>: <span class="comment">// To placate the compiler</span></span><br><span class="line">                <span class="keyword">case</span> PAPER: <span class="keyword">return</span> DRAW;</span><br><span class="line">                <span class="keyword">case</span> SCISSORS: <span class="keyword">return</span> LOSE;</span><br><span class="line">                <span class="keyword">case</span> ROCK: <span class="keyword">return</span> WIN;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    SCISSORS &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Outcome <span class="title">compete</span><span class="params">(RoShamBo3 it)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">switch</span>(it) &#123;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">case</span> PAPER: <span class="keyword">return</span> WIN;</span><br><span class="line">                <span class="keyword">case</span> SCISSORS: <span class="keyword">return</span> DRAW;</span><br><span class="line">                <span class="keyword">case</span> ROCK: <span class="keyword">return</span> LOSE;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    ROCK &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Outcome <span class="title">compete</span><span class="params">(RoShamBo3 it)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">switch</span>(it) &#123;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">case</span> PAPER: <span class="keyword">return</span> LOSE;</span><br><span class="line">                <span class="keyword">case</span> SCISSORS: <span class="keyword">return</span> WIN;</span><br><span class="line">                <span class="keyword">case</span> ROCK: <span class="keyword">return</span> DRAW;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Outcome <span class="title">compete</span><span class="params">(RoShamBo3 it)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        RoShamBo.play(RoShamBo3.class, <span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出为：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ROCK vs. <span class="string">ROCK:</span> DRAW</span><br><span class="line">SCISSORS vs. <span class="string">ROCK:</span> LOSE</span><br><span class="line">SCISSORS vs. <span class="string">ROCK:</span> LOSE</span><br><span class="line">SCISSORS vs. <span class="string">ROCK:</span> LOSE</span><br><span class="line">PAPER vs. <span class="string">SCISSORS:</span> LOSE</span><br><span class="line">PAPER vs. <span class="string">PAPER:</span> DRAW</span><br><span class="line">PAPER vs. <span class="string">SCISSORS:</span> LOSE</span><br><span class="line">ROCK vs. <span class="string">SCISSORS:</span> WIN</span><br><span class="line">SCISSORS vs. <span class="string">SCISSORS:</span> DRAW</span><br><span class="line">ROCK vs. <span class="string">SCISSORS:</span> WIN</span><br><span class="line">SCISSORS vs. <span class="string">PAPER:</span> WIN</span><br><span class="line">SCISSORS vs. <span class="string">PAPER:</span> WIN</span><br><span class="line">ROCK vs. <span class="string">PAPER:</span> LOSE</span><br><span class="line">ROCK vs. <span class="string">SCISSORS:</span> WIN</span><br><span class="line">SCISSORS vs. <span class="string">ROCK:</span> LOSE</span><br><span class="line">PAPER vs. <span class="string">SCISSORS:</span> LOSE</span><br><span class="line">SCISSORS vs. <span class="string">PAPER:</span> WIN</span><br><span class="line">SCISSORS vs. <span class="string">PAPER:</span> WIN</span><br><span class="line">SCISSORS vs. <span class="string">PAPER:</span> WIN</span><br><span class="line">SCISSORS vs. <span class="string">PAPER:</span> WIN</span><br></pre></td></tr></table></figure>

<p>虽然这种方式可以工作，但是却不甚合理，如果采用 RoShamB02.java 的解决方案，那么在添加一个新的类型时，只需更少的代码，而且也更直接。</p>
<p>:然而，RoShamBo3.java 还可以压缩简化一下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enums/RoShamBo4.java</span></span><br><span class="line"><span class="comment">// &#123;java enums.RoShamBo4&#125;</span></span><br><span class="line"><span class="keyword">package</span> enums;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> RoShamBo4 implements Competitor&lt;RoShamBo4&gt; &#123;</span><br><span class="line">    ROCK &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Outcome <span class="title">compete</span><span class="params">(RoShamBo4 opponent)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> compete(SCISSORS, opponent);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    SCISSORS &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Outcome <span class="title">compete</span><span class="params">(RoShamBo4 opponent)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> compete(PAPER, opponent);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    PAPER &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Outcome <span class="title">compete</span><span class="params">(RoShamBo4 opponent)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> compete(ROCK, opponent);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="function">Outcome <span class="title">compete</span><span class="params">(RoShamBo4 loser, RoShamBo4 opponent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ((opponent == <span class="keyword">this</span>) ? Outcome.DRAW</span><br><span class="line">                : ((opponent == loser) ? Outcome.WIN</span><br><span class="line">                : Outcome.LOSE));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        RoShamBo.play(RoShamBo4.class, <span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出为：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">PAPER vs. <span class="string">PAPER:</span> DRAW</span><br><span class="line">SCISSORS vs. <span class="string">PAPER:</span> WIN</span><br><span class="line">SCISSORS vs. <span class="string">PAPER:</span> WIN</span><br><span class="line">SCISSORS vs. <span class="string">PAPER:</span> WIN</span><br><span class="line">ROCK vs. <span class="string">SCISSORS:</span> WIN</span><br><span class="line">ROCK vs. <span class="string">ROCK:</span> DRAW</span><br><span class="line">ROCK vs. <span class="string">SCISSORS:</span> WIN</span><br><span class="line">PAPER vs. <span class="string">SCISSORS:</span> LOSE</span><br><span class="line">SCISSORS vs. <span class="string">SCISSORS:</span> DRAW</span><br><span class="line">PAPER vs. <span class="string">SCISSORS:</span> LOSE</span><br><span class="line">SCISSORS vs. <span class="string">ROCK:</span> LOSE</span><br><span class="line">SCISSORS vs. <span class="string">ROCK:</span> LOSE</span><br><span class="line">PAPER vs. <span class="string">ROCK:</span> WIN</span><br><span class="line">PAPER vs. <span class="string">SCISSORS:</span> LOSE</span><br><span class="line">SCISSORS vs. <span class="string">PAPER:</span> WIN</span><br><span class="line">ROCK vs. <span class="string">SCISSORS:</span> WIN</span><br><span class="line">SCISSORS vs. <span class="string">ROCK:</span> LOSE</span><br><span class="line">SCISSORS vs. <span class="string">ROCK:</span> LOSE</span><br><span class="line">SCISSORS vs. <span class="string">ROCK:</span> LOSE</span><br><span class="line">SCISSORS vs. <span class="string">ROCK:</span> LOSE</span><br></pre></td></tr></table></figure>

<p>其中，具有两个参数的 compete() 方法执行第二个分发，该方法执行一系列的比较，其行为类似 switch 语句。这个版本的程序更简短，不过却比较难理解，对于一个大型系统而言，难以理解的代码将导致整个系统不够健壮。</p>
<h3 id="使用-EnumMap-进行分发"><a href="#使用-EnumMap-进行分发" class="headerlink" title="使用 EnumMap 进行分发"></a>使用 EnumMap 进行分发</h3><p>使用 EnumMap 能够实现“真正的”两路分发。EnumMap 是为 enum 专门设计的一种性能非常好的特殊 Map。由于我们的目的是摸索出两种未知的类型，所以可以用一个 EnumMap 的 EnumMap 来实现两路分发：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enums/RoShamBo5.java</span></span><br><span class="line"><span class="comment">// Multiple dispatching using an EnumMap of EnumMaps</span></span><br><span class="line"><span class="comment">// &#123;java enums.RoShamBo5&#125;</span></span><br><span class="line"><span class="keyword">package</span> enums;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> enums.Outcome.*;</span><br><span class="line"><span class="keyword">enum</span> RoShamBo5 implements Competitor&lt;RoShamBo5&gt; &#123;</span><br><span class="line">    PAPER, SCISSORS, ROCK;</span><br><span class="line">    <span class="keyword">static</span> EnumMap&lt;RoShamBo5,EnumMap&lt;RoShamBo5,Outcome&gt;&gt;</span><br><span class="line">            table = <span class="keyword">new</span> EnumMap&lt;&gt;(RoShamBo5.class);</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(RoShamBo5 it : RoShamBo5.values())</span><br><span class="line">            table.put(it, <span class="keyword">new</span> EnumMap&lt;&gt;(RoShamBo5.class));</span><br><span class="line">        initRow(PAPER, DRAW, LOSE, WIN);</span><br><span class="line">        initRow(SCISSORS, WIN, DRAW, LOSE);</span><br><span class="line">        initRow(ROCK, LOSE, WIN, DRAW);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">initRow</span><span class="params">(RoShamBo5 it,</span></span></span><br><span class="line"><span class="function"><span class="params">                        Outcome vPAPER, Outcome vSCISSORS, Outcome vROCK)</span> </span>&#123;</span><br><span class="line">        EnumMap&lt;RoShamBo5,Outcome&gt; row =</span><br><span class="line">                RoShamBo5.table.get(it);</span><br><span class="line">        row.put(RoShamBo5.PAPER, vPAPER);</span><br><span class="line">        row.put(RoShamBo5.SCISSORS, vSCISSORS);</span><br><span class="line">        row.put(RoShamBo5.ROCK, vROCK);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Outcome <span class="title">compete</span><span class="params">(RoShamBo5 it)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> table.get(<span class="keyword">this</span>).get(it);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        RoShamBo.play(RoShamBo5.class, <span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出为：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ROCK vs. <span class="string">ROCK:</span> DRAW</span><br><span class="line">SCISSORS vs. <span class="string">ROCK:</span> LOSE</span><br><span class="line">SCISSORS vs. <span class="string">ROCK:</span> LOSE</span><br><span class="line">SCISSORS vs. <span class="string">ROCK:</span> LOSE</span><br><span class="line">PAPER vs. <span class="string">SCISSORS:</span> LOSE</span><br><span class="line">PAPER vs. <span class="string">PAPER:</span> DRAW</span><br><span class="line">PAPER vs. <span class="string">SCISSORS:</span> LOSE</span><br><span class="line">ROCK vs. <span class="string">SCISSORS:</span> WIN</span><br><span class="line">SCISSORS vs. <span class="string">SCISSORS:</span> DRAW</span><br><span class="line">ROCK vs. <span class="string">SCISSORS:</span> WIN</span><br><span class="line">SCISSORS vs. <span class="string">PAPER:</span> WIN</span><br><span class="line">SCISSORS vs. <span class="string">PAPER:</span> WIN</span><br><span class="line">ROCK vs. <span class="string">PAPER:</span> LOSE</span><br><span class="line">ROCK vs. <span class="string">SCISSORS:</span> WIN</span><br><span class="line">SCISSORS vs. <span class="string">ROCK:</span> LOSE</span><br><span class="line">PAPER vs. <span class="string">SCISSORS:</span> LOSE</span><br><span class="line">SCISSORS vs. <span class="string">PAPER:</span> WIN</span><br><span class="line">SCISSORS vs. <span class="string">PAPER:</span> WIN</span><br><span class="line">SCISSORS vs. <span class="string">PAPER:</span> WIN</span><br><span class="line">SCISSORS vs. <span class="string">PAPER:</span> WIN</span><br></pre></td></tr></table></figure>

<p>该程序在一个 static 子句中初始化 EnumMap 对象，具体见表格似的 initRow() 方法调用。请注意 compete() 方法，您可以看到，在一行语句中发生了两次分发。</p>
<h3 id="使用二维数组"><a href="#使用二维数组" class="headerlink" title="使用二维数组"></a>使用二维数组</h3><p>我们还可以进一步简化实现两路分发的解决方案。我们注意到，每个 enum 实例都有一个固定的值（基于其声明的次序），并且可以通过 ordinal() 方法取得该值。因此我们可以使用二维数组，将竞争者映射到竞争结果。采用这种方式能够获得最简洁、最直接的解决方案（很可能也是最快速的，虽然我们知道 EnumMap 内部其实也是使用数组实现的）。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">We can simplify the solution even more by noting that each  <span class="keyword">enum</span> instance has a fixed</span><br><span class="line">        value (based on its declaration order) <span class="function">and that  <span class="title">ordinal</span><span class="params">()</span> produces <span class="keyword">this</span> value. A two-</span></span><br><span class="line"><span class="function">        dimensional array mapping the competitors onto the outcomes produces the smallest</span></span><br><span class="line"><span class="function">        and most straightforward <span class="title">solution</span> <span class="params">(and possibly the fastest, although remember that</span></span></span><br><span class="line"><span class="function"><span class="params">        EnumMap uses an internal array)</span>:</span></span><br><span class="line"><span class="function"><span class="comment">// enums/RoShamBo6.java</span></span></span><br><span class="line"><span class="function"><span class="comment">// Enums using "tables" instead of multiple dispatch</span></span></span><br><span class="line"><span class="function"><span class="comment">// &#123;java enums.RoShamBo6&#125;</span></span></span><br><span class="line"><span class="function">        <span class="keyword">package</span> enums</span>;</span><br><span class="line">        <span class="keyword">import</span> <span class="keyword">static</span> enums.Outcome.*;</span><br><span class="line"><span class="keyword">enum</span> RoShamBo6 implements Competitor&lt;RoShamBo6&gt; &#123;</span><br><span class="line">    PAPER, SCISSORS, ROCK;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Outcome[][] table = &#123;</span><br><span class="line">            &#123; DRAW, LOSE, WIN &#125;, <span class="comment">// PAPER</span></span><br><span class="line">            &#123; WIN, DRAW, LOSE &#125;, <span class="comment">// SCISSORS</span></span><br><span class="line">            &#123; LOSE, WIN, DRAW &#125;, <span class="comment">// ROCK</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Outcome <span class="title">compete</span><span class="params">(RoShamBo6 other)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> table[<span class="keyword">this</span>.ordinal()][other.ordinal()];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        RoShamBo.play(RoShamBo6.class, <span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出为：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ROCK vs. <span class="string">ROCK:</span> DRAW</span><br><span class="line">SCISSORS vs. <span class="string">ROCK:</span> LOSE</span><br><span class="line">SCISSORS vs. <span class="string">ROCK:</span> LOSE</span><br><span class="line">SCISSORS vs. <span class="string">ROCK:</span> LOSE</span><br><span class="line">PAPER vs. <span class="string">SCISSORS:</span> LOSE</span><br><span class="line">PAPER vs. <span class="string">PAPER:</span> DRAW</span><br><span class="line">PAPER vs. <span class="string">SCISSORS:</span> LOSE</span><br><span class="line">ROCK vs. <span class="string">SCISSORS:</span> WIN</span><br><span class="line">SCISSORS vs. <span class="string">SCISSORS:</span> DRAW</span><br><span class="line">ROCK vs. <span class="string">SCISSORS:</span> WIN</span><br><span class="line">SCISSORS vs. <span class="string">PAPER:</span> WIN</span><br><span class="line">SCISSORS vs. <span class="string">PAPER:</span> WIN</span><br><span class="line">ROCK vs. <span class="string">PAPER:</span> LOSE</span><br><span class="line">ROCK vs. <span class="string">SCISSORS:</span> WIN</span><br><span class="line">SCISSORS vs. <span class="string">ROCK:</span> LOSE</span><br><span class="line">PAPER vs. <span class="string">SCISSORS:</span> LOSE</span><br><span class="line">SCISSORS vs. <span class="string">PAPER:</span> WIN</span><br><span class="line">SCISSORS vs. <span class="string">PAPER:</span> WIN</span><br><span class="line">SCISSORS vs. <span class="string">PAPER:</span> WIN</span><br><span class="line">SCISSORS vs. <span class="string">PAPER:</span> WIN</span><br></pre></td></tr></table></figure>

<p>table 与前一个例子中 initRow() 方法的调用次序完全相同。</p>
<p>与前面一个例子相比，这个程序代码虽然简短，但表达能力却更强，部分原因是其代码更易于理解与修改，而且也更直接。不过，由于它使用的是数组，所以这种方式不太“安全”。如果使用一个大型数组，可能会不小心使用了错误的尺寸，而且，如果你的测试不能覆盖所有的可能性，有些错误可能会从你眼前溜过。</p>
<p>事实上，以上所有的解决方案只是各种不同类型的表罢了。不过，分析各种表的表现形式，找出最适合的那一种，还是很有价值的。注意，虽然上例是最简洁的一种解决方案，但它也是相当僵硬的方案，因为它只能针对给定的常量输入产生常量输出。然而，也没有什么特别的理由阻止你用 table 来生成功能对象。对于某类问题而言，“表驱动式编码”的概念具有非常强大的功能。</p>
<!-- Summary -->

<h2 id="本章小结"><a href="#本章小结" class="headerlink" title="本章小结"></a>本章小结</h2><p>虽然枚举类型本身并不是特别复杂，但我还是将本章安排在全书比较靠后的位置，这是因为，程序员可以将 enum 与 Java 语言的其他功能结合使用，例如多态、泛型和反射。</p>
<p>虽然 Java 中的枚举比 C 或 C++中的 enum 更成熟，但它仍然是一个“小”功能，Java 没有它也已经（虽然有点笨拙）存在很多年了。而本章正好说明了一个“小”功能所能带来的价值。有时恰恰因为它，你才能够优雅而干净地解决问题。正如我在本书中一再强调的那样，优雅与清晰很重要，正是它们区别了成功的解决方案与失败的解决方案。而失败的解决方案就是因为其他人无法理解它。</p>
<p>关于清晰的话题，Java 1.0 对术语 enumeration 的选择正是一个不幸的反例。对于一个专门用于从序列中选择每一个元素的对象而言，Java 竟然没有使用更通用、更普遍接受的术语 ierator 来表示它（参见<a href>集合 </a> 章节），有些语言甚至将枚举的数据类型称为 “enumerators”！Java 修正了这个错误，但是 Enumeration 接口已经无法轻易地抹去了，因此它将一直存在于旧的（甚至有些新的）代码、类库以及文档中。</p>
<!-- Annotations -->

<h1 id="第二十三章-注解"><a href="#第二十三章-注解" class="headerlink" title="第二十三章 注解"></a>第二十三章 注解</h1><!-- Skip,No read -->

<h1 id="issue"><a href="#issue" class="headerlink" title="issue"></a>issue</h1><p><code>equals()</code> 方法的标准形式参考 <a href="book/Appendix-Understanding-equals-and-hashCode">附录：理解 equals 和 hashCode 方法</a> 一章。</p>
<h1 id="你可以在-附录-流式-I-O-了解更多内容）"><a href="#你可以在-附录-流式-I-O-了解更多内容）" class="headerlink" title="你可以在 附录:流式 I/O 了解更多内容）"></a>你可以在 <a href="./Appendix-IO-Streams.md">附录:流式 I/O</a> 了解更多内容）</h1><h3 id="这种”困难方式”的全部细节都在-Appendix-I-O-Streams。"><a href="#这种”困难方式”的全部细节都在-Appendix-I-O-Streams。" class="headerlink" title="这种”困难方式”的全部细节都在 Appendix: I/O Streams。"></a>这种”困难方式”的全部细节都在 <a href="./Appendix-IO-Streams.md">Appendix: I/O Streams</a>。</h3><h2 id="附录：集合主题中，还将学习到其余的那些集合和相关功能，以及如何使用它们的更多详细信息。"><a href="#附录：集合主题中，还将学习到其余的那些集合和相关功能，以及如何使用它们的更多详细信息。" class="headerlink" title="附录：集合主题中，还将学习到其余的那些集合和相关功能，以及如何使用它们的更多详细信息。"></a><a href>附录：集合主题</a>中，还将学习到其余的那些集合和相关功能，以及如何使用它们的更多详细信息。</h2><h2 id="在泛型章节中，你将了解到使用-Java-泛型来创建类可能很复杂。"><a href="#在泛型章节中，你将了解到使用-Java-泛型来创建类可能很复杂。" class="headerlink" title="在泛型章节中，你将了解到使用 Java 泛型来创建类可能很复杂。"></a>在<a href>泛型</a>章节中，你将了解到使用 Java 泛型来创建类可能很复杂。</h2><h2 id="将在附录：理解equals和hashCode方法中了解有关散列码的内容。"><a href="#将在附录：理解equals和hashCode方法中了解有关散列码的内容。" class="headerlink" title="将在附录：理解equals和hashCode方法中了解有关散列码的内容。"></a>将在<a href>附录：理解equals和hashCode方法</a>中了解有关散列码的内容。</h2><h2 id="并行-并发：使用并行编程技术编写，如果只有一个处理器，结果程序仍然可以运行（-Java-8-Streams-就是一个很好的例子）。"><a href="#并行-并发：使用并行编程技术编写，如果只有一个处理器，结果程序仍然可以运行（-Java-8-Streams-就是一个很好的例子）。" class="headerlink" title="并行-并发：使用并行编程技术编写，如果只有一个处理器，结果程序仍然可以运行（==Java 8 Streams==就是一个很好的例子）。"></a>并行-并发：使用并行编程技术编写，如果只有一个处理器，结果程序仍然可以运行（==Java 8 Streams==就是一个很好的例子）。</h2><h2 id="对并发性的语言和库支持似乎-Leaky-Abstraction是完美候选者-。抽象的目标是“抽象出”那些对于手头想法不重要的东西，从不必要的细节中汲取灵感。如果抽象是漏洞，那些碎片和细节会不断重新声明自己是重要的，无论你试图隐藏它们多少"><a href="#对并发性的语言和库支持似乎-Leaky-Abstraction是完美候选者-。抽象的目标是“抽象出”那些对于手头想法不重要的东西，从不必要的细节中汲取灵感。如果抽象是漏洞，那些碎片和细节会不断重新声明自己是重要的，无论你试图隐藏它们多少" class="headerlink" title="对并发性的语言和库支持似乎==Leaky Abstraction是完美候选者==。抽象的目标是“抽象出”那些对于手头想法不重要的东西，从不必要的细节中汲取灵感。如果抽象是漏洞，那些碎片和细节会不断重新声明自己是重要的，无论你试图隐藏它们多少"></a>对并发性的语言和库支持似乎==<a href="https://en.wikipedia.org/wiki/Leaky_abstraction" target="_blank" rel="noopener">Leaky Abstraction</a>是完美候选者==。抽象的目标是“抽象出”那些对于手头想法不重要的东西，从不必要的细节中汲取灵感。如果抽象是漏洞，那些碎片和细节会不断重新声明自己是重要的，无论你试图隐藏它们多少</h2><p>直到 [附录:集合主题]</p>
<p>在附录中有包含：<a href="./Appendix-Passing-and-Returning-Objects.md">对象传递和返回</a>。</p>
<p>我们直接给出正确的结果：<code>Math.random()</code> 的结果集范围包含 0.0 ，不包含 1.0。 在数学术语中，可用 [0,1）来表示。</p>
<h1 id="other"><a href="#other" class="headerlink" title="other"></a>other</h1><h2 id="javap"><a href="#javap" class="headerlink" title="javap"></a>javap</h2><p><strong>可以用 JDK 自带的 <code>javap</code> 工具来反编译以上代码。</strong>命令如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javap -c Concatenation</span><br></pre></td></tr></table></figure>

<p><strong>这里的 <code>-c</code> 标志表示将生成 JVM 字节码。</strong>我们剔除不感兴趣的部分，然后做细微的修改，于是有了以下的字节码：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">public</span> static void main(java.lang.String[])<span class="comment">; </span></span><br><span class="line"><span class="symbol"> Code:</span></span><br><span class="line">  Stack=<span class="number">2</span>, Locals=<span class="number">3</span>, Args_size=<span class="number">1</span></span><br><span class="line">  <span class="number">0</span>: ldc #<span class="number">2</span><span class="comment">; //String mango </span></span><br><span class="line">  <span class="number">2</span>: astore_1 </span><br><span class="line">  <span class="number">3</span>: new #<span class="number">3</span><span class="comment">; //class StringBuilder </span></span><br><span class="line">  <span class="number">6</span>: dup </span><br><span class="line">  <span class="number">7</span>: invokespecial #<span class="number">4</span><span class="comment">; //StringBuilder."&lt;init&gt;":() </span></span><br><span class="line">  <span class="number">10</span>: ldc #<span class="number">5</span><span class="comment">; //String abc </span></span><br><span class="line">  <span class="number">12</span>: invokevirtual #<span class="number">6</span><span class="comment">; //StringBuilder.append:(String) </span></span><br><span class="line">  <span class="number">15</span>: aload_1 </span><br><span class="line">  <span class="number">16</span>: invokevirtual #<span class="number">6</span><span class="comment">; //StringBuilder.append:(String) </span></span><br><span class="line">  <span class="number">19</span>: ldc #<span class="number">7</span><span class="comment">; //String def </span></span><br><span class="line">  <span class="number">21</span>: invokevirtual #<span class="number">6</span><span class="comment">; //StringBuilder.append:(String) </span></span><br><span class="line">  <span class="number">24</span>: bipush <span class="number">47</span> </span><br><span class="line">  <span class="number">26</span>: invokevirtual #<span class="number">8</span><span class="comment">; //StringBuilder.append:(I) </span></span><br><span class="line">  <span class="number">29</span>: invokevirtual #<span class="number">9</span><span class="comment">; //StringBuilder.toString:() </span></span><br><span class="line">  <span class="number">32</span>: astore_2 </span><br><span class="line">  <span class="number">33</span>: getstatic #<span class="number">10</span><span class="comment">; //Field System.out:PrintStream;</span></span><br><span class="line">  <span class="number">36</span>: aload_2 </span><br><span class="line">  <span class="number">37</span>: invokevirtual #<span class="number">11</span><span class="comment">; //PrintStream.println:(String) </span></span><br><span class="line">  <span class="number">40</span>: return</span><br></pre></td></tr></table></figure>

<p>如果你有汇编语言的经验，以上代码应该很眼熟(其中的 <code>dup</code> 和 <code>invokevirtual</code> 语句相当于Java虚拟机上的汇编语句。即使你完全不了解汇编语言也无需担心)。<strong>需要重点注意的是：编译器自动引入了 <code>java.lang.StringBuilder</code> 类。虽然源代码中并没有使用 <code>StringBuilder</code> 类，但是编译器却自作主张地使用了它，就因为它更高效。</strong></p>
<p>在这里，编译器创建了一个 <code>StringBuilder</code> 对象，用于构建最终的 <code>String</code>，并对每个字符串调用了一次 <code>append()</code> 方法，共计 4 次。最后调用 <code>toString()</code> 生成结果，并存为 <code>s</code> (使用的命令为 <code>astore_2</code>)。</p>
<h2 id="System-out-format"><a href="#System-out-format" class="headerlink" title="System.out.format()"></a><code>System.out.format()</code></h2><p> <code>System.out.format()</code> 来显示。它类似于 <code>System.out.println()</code> 但提供了更多的显示选项。 这里，<code>%f</code> 表示我将 <code>n</code> 作为浮点值给出，<code>%d</code> 表示 <code>n</code> 是一个整数值。 这其中可以包含空格，输入 <code>%n</code> 会换行 — 当然使用传统的 <code>\n</code> 也能换行，但 <code>%n</code> 是自动跨平台的，这是使用 <code>format()</code> 的另一个原因。</p>
<!-- Higher-Order Functions-->

<h2 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h2><p>这个名字可能听起来令人生畏，但是：<a href="https://en.wikipedia.org/wiki/Higher-order_function" target="_blank" rel="noopener">高阶函数</a>（Higher-order Function）只是一个消费或产生函数的函数。</p>
<p>我们先来看看如何产生一个函数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// functional/ProduceFunction.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.function.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span></span></span><br><span class="line"><span class="class"><span class="title">FuncSS</span> <span class="keyword">extends</span> <span class="title">Function</span>&lt;<span class="title">String</span>, <span class="title">String</span>&gt; </span>&#123;&#125; <span class="comment">// [1]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProduceFunction</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">static</span> FuncSS <span class="title">produce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> s -&gt; s.toLowerCase(); <span class="comment">// [2]</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    FuncSS f = produce();</span><br><span class="line">    System.out.println(f.apply(<span class="string">"YELLING"</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出结果：</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">yelling</span></span><br></pre></td></tr></table></figure>

<p>这里，<code>produce()</code> 是高阶函数。</p>
<p><strong>[1]</strong> 使用继承，可以轻松地为专用接口创建别名。</p>
<p><strong>[2]</strong> 使用 Lambda 表达式，可以轻松地在方法中创建和返回一个函数。</p>
<p>要消费一个函数，消费函数需要在参数列表正确地描述函数类型。代码示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// functional/ConsumeFunction.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.function.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">One</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Two</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumeFunction</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">static</span> Two <span class="title">consume</span><span class="params">(Function&lt;One,Two&gt; onetwo)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> onetwo.apply(<span class="keyword">new</span> One());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Two two = consume(one -&gt; <span class="keyword">new</span> Two());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当基于消费函数生成新函数时，事情就变得相当有趣了。代码示例如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// functional/TransformFunction.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.function.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">I</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="string">"I"</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">O</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="string">"O"</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransformFunction</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">static</span> Function&lt;I,O&gt; <span class="title">transform</span><span class="params">(Function&lt;I,O&gt; in)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> in.andThen(o -&gt; &#123;</span><br><span class="line">      System.out.println(o);</span><br><span class="line">      <span class="keyword">return</span> o;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Function&lt;I,O&gt; f2 = transform(i -&gt; &#123;</span><br><span class="line">      System.out.println(i);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> O();</span><br><span class="line">    &#125;);</span><br><span class="line">    O o = f2.apply(<span class="keyword">new</span> I());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出结果：</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">I</span></span><br><span class="line"><span class="attribute">O</span></span><br></pre></td></tr></table></figure>

<p>在这里，<code>transform()</code> 生成一个与传入的函数具有相同签名的函数，但是你可以生成任何你想要的类型。</p>
<p>这里使用到了 <code>Function</code> 接口中名为 <code>andThen()</code> 的默认方法，该方法专门用于操作函数。 顾名思义，在调用 <code>in</code> 函数之后调用 <code>toThen()</code>（还有个 <code>compose()</code> 方法，它在 <code>in</code> 函数之前应用新函数）。 要附加一个 <code>andThen()</code> 函数，我们只需将该函数作为参数传递。 <code>transform()</code> 产生的是一个新函数，它将 <code>in</code> 的动作与 <code>andThen()</code> 参数的动作结合起来。</p>
<h2 id="获取类名"><a href="#获取类名" class="headerlink" title="获取类名"></a>获取类名</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Reporter</span> <span class="keyword">implements</span> <span class="title">AutoCloseable</span> </span>&#123;</span><br><span class="line">    String name = getClass().getSimpleName();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="揭示细节"><a href="#揭示细节" class="headerlink" title="揭示细节"></a>揭示细节</h3><p>为了研究 try-with-resources 的基本机制，我们将创建自己的 AutoCloseable 类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// exceptions/AutoCloseableDetails.java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Reporter</span> <span class="keyword">implements</span> <span class="title">AutoCloseable</span> </span>&#123;</span><br><span class="line">    String name = getClass().getSimpleName();</span><br><span class="line">    Reporter() &#123;</span><br><span class="line">        System.out.println(<span class="string">"Creating "</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Closing "</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">First</span> <span class="keyword">extends</span> <span class="title">Reporter</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Second</span> <span class="keyword">extends</span> <span class="title">Reporter</span> </span>&#123;&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AutoCloseableDetails</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span>(</span><br><span class="line">                First f = <span class="keyword">new</span> First();</span><br><span class="line">                Second s = <span class="keyword">new</span> Second()</span><br><span class="line">        ) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出为：</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Creating <span class="built_in">First</span></span><br><span class="line">Creating <span class="built_in">Second</span></span><br><span class="line">Closing <span class="built_in">Second</span></span><br><span class="line">Closing <span class="built_in">First</span></span><br></pre></td></tr></table></figure>

<p>退出 try 块会调用两个对象的 close() 方法，并以与<strong>创建顺序相反的顺序关闭它们。</strong>顺序很重要，因为在此配置中，Second 对象可能依赖于 First 对象，因此如果 First 在第 Second 关闭时已经关闭。 Second 的 close() 方法可能会尝试访问 First 中不再可用的某些功能。</p>
<!-- Exception Matching -->

<h2 id="异常匹配"><a href="#异常匹配" class="headerlink" title="异常匹配"></a>异常匹配</h2><h2 id="System-nanoTime"><a href="#System-nanoTime" class="headerlink" title="System.nanoTime()"></a>System.nanoTime()</h2><blockquote>
<p>返回正在运行的Java虚拟机的高分辨率时间源的当前值，以纳秒为单位。</p>
<p><strong>此方法只能用于测量经过的时间，并且与系统或挂钟时间的任何其他概念无关。返回的值表示纳秒，因为某些固定的任意原点时间</strong> （可能在将来，因此值可能为负）。</p>
<p>在Java虚拟机的实例中，所有对此方法的调用都使用相同的原点;其他虚拟机实例可能使用不同的来源。 此方法提供纳秒级精度，但不一定是纳秒级分辨率（即，值的变化频率） - 除了分辨率至少与currentTimeMillis（）的分辨率一样好之外，不做任何保证。</p>
<p>连续调用的差异超过大约292年（2^63纳秒）将无法正确计算由于数值溢出而导致的经过时间。 只有在计算在Java虚拟机的同一实例中获得的两个此类值之间的差异时，此方法返回的值才有意义。</p>
<p>例如，要测量某些代码执行所需的时间：</p>
<p>long startTime = System.nanoTime（）; // …正在测量的代码…… long estimatedTime = System.nanoTime（） -  startTime; 比较两个nanoTime值 long t0 = System.nanoTime（）; … long t1 = System.nanoTime（）;</p>
<p>一个应该使用t1 - t0 &lt;0，而不是t1 &lt;t0，因为数字溢出的可能性.</p>
<p>Returns：正在运行的Java虚拟机的高分辨率时间源的当前值，以纳秒为单位</p>
<p>从以下版本开始：1.5</p>
</blockquote>
<h1 id="并发编程"><a href="#并发编程" class="headerlink" title="并发编程"></a>并发编程</h1><p><a href="https://github.com/LingCoder/OnJava8/blob/master/docs/book/24-Concurrent-Programming.md" target="_blank" rel="noopener">并发编程</a></p>
<p>对于更多凌乱，低级别的细节，请参阅附录：<a href="https://github.com/LingCoder/OnJava8/blob/master/docs/book/Appendix-Low-Level-Concurrency.md" target="_blank" rel="noopener">并发底层原理</a></p>
<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>要进一步深入这个领域，你还必须阅读Brian Goetz等人的Java Concurrency in Practice。</p>
<ul>
<li>并发是关于正确有效地控制对共享资源的访问。</li>
<li>并行是使用额外的资源来更快地产生结果。</li>
</ul>
<p><em>并发</em></p>
<p><strong>同时完成多个任务。在开始处理其他任务之前，当前任务不需要完成。并发解决了阻塞发生的问题。</strong>当任务无法进一步执行，直到外部环境发生变化时才会继续执行。最常见的例子是I/O，其中任务必须等待一些input（在这种情况下会被阻止）。<strong>这个问题产生在I/O密集型。</strong></p>
<p><em>并行</em></p>
<p><strong>同时在多个地方完成多个任务。</strong>这<strong>解决了所谓的计算密集型问题</strong>，如果将程序分成多个部分并在不同的处理器上编辑不同的部分，程序可以运行得更快。</p>
<blockquote>
<p><strong>并发性是一系列性能技术，专注于减少等待</strong></p>
</blockquote>
<p><strong>在Java中，并发是非常棘手和困难的，所以绝对不要使用它，除非你有一个重大的性能问题</strong></p>

    </div>

    
    
    
    
    <div>
     
      <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>

     
    </div>
    
        
      
        <div id="reward-container">
  <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
  <button id="reward-button" disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">

  </div>
</div>

      
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>nicolas lee</li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://codeofli.github.io/2019/10/java-note/OnJava8/OnJava8-4/" title="OnJava8-4">https://codeofli.github.io/2019/10/java-note/OnJava8/OnJava8-4/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li>
</ul>
</div>

      

      <footer class="post-footer">
          
            
          
          <div class="post-tags">
            
              <a href="/tags/学习笔记/" rel="tag"># 学习笔记</a>
            
          </div>
        

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/2019/10/java-note/OnJava8/OnJava8-3/" rel="next" title="OnJava8-3">
                  <i class="fa fa-chevron-left"></i> OnJava8-3
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/2019/10/java-note/javaDev/javaDev/" rel="prev" title="javaDev">
                  javaDev <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">
        
        
        
        
      

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#第二十二章-枚举"><span class="nav-number">1.</span> <span class="nav-text">第二十二章 枚举</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#基本-enum-特性"><span class="nav-number">1.1.</span> <span class="nav-text">基本 enum 特性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#将静态类型导入用于-enum"><span class="nav-number">1.1.1.</span> <span class="nav-text">将静态类型导入用于 enum</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#方法添加"><span class="nav-number">1.2.</span> <span class="nav-text">方法添加</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#覆盖-enum-的方法"><span class="nav-number">1.2.1.</span> <span class="nav-text">覆盖 enum 的方法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#switch-语句中的-enum"><span class="nav-number">1.3.</span> <span class="nav-text">switch 语句中的 enum</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#values-方法的神秘之处"><span class="nav-number">1.4.</span> <span class="nav-text">values 方法的神秘之处</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实现而非继承"><span class="nav-number">1.5.</span> <span class="nav-text">实现而非继承</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#随机选择"><span class="nav-number">1.6.</span> <span class="nav-text">随机选择</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用接口组织枚举"><span class="nav-number">1.7.</span> <span class="nav-text">使用接口组织枚举</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用-EnumSet-替代-Flags"><span class="nav-number">1.8.</span> <span class="nav-text">使用 EnumSet 替代 Flags</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用-EnumMap"><span class="nav-number">1.9.</span> <span class="nav-text">使用 EnumMap</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#常量特定方法"><span class="nav-number">1.10.</span> <span class="nav-text">常量特定方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用-enum-的职责链"><span class="nav-number">1.10.1.</span> <span class="nav-text">使用 enum 的职责链</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用-enum-的状态机"><span class="nav-number">1.10.2.</span> <span class="nav-text">使用 enum 的状态机</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#多路分发"><span class="nav-number">1.11.</span> <span class="nav-text">多路分发</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用-enum-分发"><span class="nav-number">1.11.1.</span> <span class="nav-text">使用 enum 分发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用常量相关的方法"><span class="nav-number">1.11.2.</span> <span class="nav-text">使用常量相关的方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用-EnumMap-进行分发"><span class="nav-number">1.11.3.</span> <span class="nav-text">使用 EnumMap 进行分发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用二维数组"><span class="nav-number">1.11.4.</span> <span class="nav-text">使用二维数组</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#本章小结"><span class="nav-number">1.12.</span> <span class="nav-text">本章小结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第二十三章-注解"><span class="nav-number">2.</span> <span class="nav-text">第二十三章 注解</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#issue"><span class="nav-number">3.</span> <span class="nav-text">issue</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#你可以在-附录-流式-I-O-了解更多内容）"><span class="nav-number">4.</span> <span class="nav-text">你可以在 附录:流式 I/O 了解更多内容）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#这种”困难方式”的全部细节都在-Appendix-I-O-Streams。"><span class="nav-number">4.0.1.</span> <span class="nav-text">这种”困难方式”的全部细节都在 Appendix: I/O Streams。</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#附录：集合主题中，还将学习到其余的那些集合和相关功能，以及如何使用它们的更多详细信息。"><span class="nav-number">4.1.</span> <span class="nav-text">附录：集合主题中，还将学习到其余的那些集合和相关功能，以及如何使用它们的更多详细信息。</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#在泛型章节中，你将了解到使用-Java-泛型来创建类可能很复杂。"><span class="nav-number">4.2.</span> <span class="nav-text">在泛型章节中，你将了解到使用 Java 泛型来创建类可能很复杂。</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#将在附录：理解equals和hashCode方法中了解有关散列码的内容。"><span class="nav-number">4.3.</span> <span class="nav-text">将在附录：理解equals和hashCode方法中了解有关散列码的内容。</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#并行-并发：使用并行编程技术编写，如果只有一个处理器，结果程序仍然可以运行（-Java-8-Streams-就是一个很好的例子）。"><span class="nav-number">4.4.</span> <span class="nav-text">并行-并发：使用并行编程技术编写，如果只有一个处理器，结果程序仍然可以运行（==Java 8 Streams==就是一个很好的例子）。</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#对并发性的语言和库支持似乎-Leaky-Abstraction是完美候选者-。抽象的目标是“抽象出”那些对于手头想法不重要的东西，从不必要的细节中汲取灵感。如果抽象是漏洞，那些碎片和细节会不断重新声明自己是重要的，无论你试图隐藏它们多少"><span class="nav-number">4.5.</span> <span class="nav-text">对并发性的语言和库支持似乎==Leaky Abstraction是完美候选者==。抽象的目标是“抽象出”那些对于手头想法不重要的东西，从不必要的细节中汲取灵感。如果抽象是漏洞，那些碎片和细节会不断重新声明自己是重要的，无论你试图隐藏它们多少</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#other"><span class="nav-number">5.</span> <span class="nav-text">other</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#javap"><span class="nav-number">5.1.</span> <span class="nav-text">javap</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#System-out-format"><span class="nav-number">5.2.</span> <span class="nav-text">System.out.format()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#高阶函数"><span class="nav-number">5.3.</span> <span class="nav-text">高阶函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#获取类名"><span class="nav-number">5.4.</span> <span class="nav-text">获取类名</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#揭示细节"><span class="nav-number">5.4.1.</span> <span class="nav-text">揭示细节</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#异常匹配"><span class="nav-number">5.5.</span> <span class="nav-text">异常匹配</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#System-nanoTime"><span class="nav-number">5.6.</span> <span class="nav-text">System.nanoTime()</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#并发编程"><span class="nav-number">6.</span> <span class="nav-text">并发编程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#概念"><span class="nav-number">6.1.</span> <span class="nav-text">概念</span></a></li></ol></li></ol></div>
        
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="/assets/img/avatar.jpg"
      alt="nicolas lee">
  <p class="site-author-name" itemprop="name">nicolas lee</p>
  <div class="site-description" itemprop="description">Yesterday you said tomorow.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">48</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        <span class="site-state-item-count">32</span>
        <span class="site-state-item-name">标签</span>
        </a>
      </div>
    
  </nav>
</div>
  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://github.com/codeOflI" title="GitHub &rarr; https://github.com/codeOflI" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://blog.csdn.net/qq_42835910" title="CSDN &rarr; https://blog.csdn.net/qq_42835910" rel="noopener" target="_blank"><i class="fa fa-fw fa-crosshairs"></i>CSDN</a>
      </span>
    
  </div>
  <div class="cc-license motion-element" itemprop="license">
    
  
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2019 – <span itemprop="copyrightYear">2021</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">nicolas lee</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    
    <span title="站点总字数"></span>
</div>


        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
  
    <span class="post-meta-divider">|</span>
  
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
  
</div>












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/js/utils.js?v=7.4.1"></script><script src="/js/motion.js?v=7.4.1"></script>
<script src="/js/schemes/pisces.js?v=7.4.1"></script>

<script src="/js/next-boot.js?v=7.4.1"></script>



  





















  

  

  

</body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>